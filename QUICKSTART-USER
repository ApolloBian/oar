Quick-start guide
=================

Visualising the cluster State
-----------------------------

There are many tools  available to visualize the cluster state.

~~~~~~~~~~~~~~~
Shell commands:
~~~~~~~~~~~~~~~

* oarnodes: this command shows the resources states. Warning: in our context, a
  resource is not necessary a machine. It is generally a cpu, a core or a host,
  but it can be much more... like licence tokens, vlan, ...
  The oarnodes command gives information about the network address where is
  located this resource, its type, its state and many other (interesting) 
  information.
  
* oarstat: this command shows information about running or planned jobs.
  (The -f option shows full infomation)

~~~~~~~~~~~~~~~~
Graphical tools:
~~~~~~~~~~~~~~~~

Monika
~~~~~~

This is a web cgi normally installed on the cluster frontal. This tool connects
to the DB, gets relevant information then format data in a html page. Thus you
can have a global view of cluster state and where your jobs are running.

DrawOARGantt
~~~~~~~~~~~~

This is also a web cgi. It creates a Gantt chart which shows job repartition on
nodes in the time. It is very useful to see cluster occupation in the past and
to know when a job will be launched in the future.

Submitting a job in an interactive shell
----------------------------------------

~~~~~~~~~~
Submission
~~~~~~~~~~

To submit an interactive job we use the "oarsub" command with the "-I" option::

  frontend:~$> oarsub -I

OAR returns then an unique job ID that will identify your job in the system::
  
  OAR_JOB_ID=1234

Once the job is scheduled, when the requested resources are available, OAR 
connects you to the first allocated node. OAR initiates environment variables 
that inform you of your submission properties::

  node:~$> env | grep OAR

Particularly, the allocated nodes list is contained in the $OAR_NODEFILE::

  node:~$> cat $OAR_NODEFILE

~~~~~~~~~~~~~
Visualisation
~~~~~~~~~~~~~

You can get information about your job by looking at the Monika or DrawGantt
interfaces or by typing in a command line console::

  frontend:~$> oarstat -fj OAR_JOB_ID

~~~~~~~~~~~~~~~
Exiting the job
~~~~~~~~~~~~~~~

To terminate an interactive job you just have to disconnect from the resource::

  node:~$> exit

You can likewise kill the job by typing::

  frontend:~$> oardel OAR_JOB_ID

In this case, the session will be killed ("kill -9").

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Interactive submission on many resources
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The "-l" option allows to specify wanted resources. For example, if we need to
work in interactive mode on 2 cpu for a max duration of 30 minutes we will
ask::

  frontend:~$> oarsub -I -l /cpu=2,walltime=00:30:00

The walltime is the job's max duration. If the job overruns its walltime, it
will be killed by the system. Thus, you better have to set your walltime
correctly depending on how long will take your job to prevent being killed if
the walltime has been set too short or being scheduled later if it is too long.
Then, once the job is scheduled and started, OAR connects you on the first
reserved node. You still can access the list of the other resources via the
$OAR_NODEFILE env variable.


Batch submission
----------------

OAR allows to execute scripts in "passive mode". In this mode, the user
specifies a script at the submission time. This script will be executed on the
first reserved node. It's within this script that the user will define the way
to operate parallel resources. All the $OAR_* env variables are reachable
within the script.

The script must be executable.

~~~~~~~~~~
Submission
~~~~~~~~~~

In this case, the principle is the same that interactive submission, just
replace the "-I" option with the path of your script::

  frontend:~$> oarsub -l /cpu=2,walltime=00:30:00 ./hello_mpi.sh

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Getting the results of the submission
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In passive mode, OAR creates 2 files: OAR.<OAR_JOB_ID>.stdout for the stdout and
OAR.<OAR_JOB_ID>.stderr for the stderr.
The name of these 2 files can be changed (see "man oarsub").

~~~~~~~~~~~~~~~~~~~~~~~~
Connecting a running job
~~~~~~~~~~~~~~~~~~~~~~~~

You can connect a running job with the "-C" option to oarsub::

  frontend:~$> oarsub -C <OAR_JOB_ID>

Thus, you will be connected to the first reserved node.

Reservations
------------

Until now we only asked for immediate start for our submission.
However it is also possible to plan a job in the future. This feature is
available through the "-r <date>" option::

  frontend:~$> oarsub -r '2008-03-07 16:45:00' -l nodes=2,walltime=0:10:00 ./hello_mpi.sh


Desktop computing
-----------------

If you want to compute jobs on nodes without SSH connections then this
feature is for you.

On the nodes you have to run "oar-agent.pl". This script polls the OAR
server via a CGI HTTP script.

Usage examples:
 - if you want to run a program that you know is installed on nodes::

    oarsub -t desktop_computing /path/to/program

   Then /path/to/program is run and the files created in the
   oar-agent.pl running directory is retrieved where oarsub was
   launched.

 - if you want to copy a working environment and then launch the program::

    oarsub -t desktop_computing -s . ./script.sh

   The content of "." is transfred to the node, "./script.sh" is run and
   everything will go back.
