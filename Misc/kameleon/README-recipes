1. Available recipes

   Recipes are stored in "<kameleon_root>/recipes/" directory.

   There are two recipes:
    - debian-lenny.yaml
    - fedora-10.yaml

   IMPORTANT: if you have mysqld, apache or sshd running on the building platform, shut them down before starting kameleon.

   Feel free to take a look at macrostep files. You'll find some lines quoted with single hash (#), and some others with double hash (##). Those that are quoted with single hash are working pieces of code that is opted out, and you can plug it in by removing the hashes. One such example is installation of X server in fedora recipe. Lines that are quoted with double hash are non working code, probably some legacy or work in progres, and in most of the cases, you should just live them like that.

1.1 Debian lenny

   Prerequisites: debootstrap, rsync, parted, kpartx, losetup, dmsetup, grub-install, awk, sed, qemu-img, VBoxManage

   If you're using Debian/Ubuntu as building platform, all dependencies can be installed using apt-get and default repositories.

   By default, recipe will download and build i386 system. If you want to build appliances for amd64 platform, you would have to:
    - use 64bit system as building platform
    - alter "arch" and "kernel_arch" and set them both to "amd64"

1.2 Fedora 10

   Prerequisites: debootstrap, rsync, parted, kpartx, losetup, dmsetup, grub-install, awk, sed, qemu-img, VBoxManage

   If you're using Debian/Ubuntu as building platform, all dependencies but rinse can be installed using apt-get and default repositories. Rinse is also available, but it's outdated and somehow broken. The best way to work around is to manually download and install Rinse from here: http://www.xen-tools.org/software/rinse/rinse-1.7.tar.gz. Don't for get to take a look at Rinse's INSTALL - it says you need rpm and rpm2cpio commands installed on the building platform.

   By default, recipe will download and build i386 system. If you want to build appliances for amd64 platform, you would have to:
    - use 64bit system as building platform
    - alter "arch" set it to "amd64"

2. Invoking kameleon

   In order to build lenny-based appliance, run:

   # sudo ./kameleon.rb ./recipes/debian-lenny-oar-2.4.yaml

   This will create appliances in /var/tmp/kameleon/<timestamp>/debian-lenny.{raw|vmdk|qcow2|vdi} and tgz-ed system in /var/tmp/kameleon/<timestamp>/debian-lenny.tgz

3. If something goes wrong

   If something goes wrong and kameleon hangs or you need to kill it, there's a helper script to be used for cleaning. It's very important to run this script right after the kameleon process dies (i.e. before starting kameleon again), because some important resources might be deadlocked (proc filesystem mounted inside chroot, image mounted on loop device etc).

   Script can be run like this:
   # sudo /bin/bash /var/tmp/kameleon/<timestamp>/clean.sh

4. Using appliances

    - Username/password for appliance: kameleon/kameleon
    - Becoming root: sudo -s
    - Mysql user/pass: root/kameleon
    - Hostname: oar
    - Network is configured for dhcp
    - Appliances are preconfigured to use OpenDSN servers
    - X can be started using "startx" (fedora still needs some tweaking here)
