\documentclass{beamer}

\usepackage{amssymb}
\usepackage{epsfig,shadow}
\usepackage{beamerthemeshadow}

\beamertemplatetransparentcovereddynamic
\setbeamertemplate{navigation symbols}{}

%%%%%%%%%%%%%%
% Title page %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title[OAR2]{
    OAR2\\
    An open source resource manager for large clusters
}
\author[LIG-ID]{
    {\bf LIG-ID}\\
    {\tiny Joseph.Emeras@imag.fr Nicolas.Capit@imag.fr Olivier.Richard@imag.fr
            Yiannis.Georgiou@imag.fr}
}

\institute{
    \begin{center}
        \includegraphics[scale=0.4]{src/img/oar_logo.png}
    \end{center}
    {\bf http://oar.imag.fr/}
}
\date{{\tiny \today}}

\begin{document}

\frame[plain]{\titlepage}

%%%%%%%%%%%%%%%%%%%%%
% Table of contents %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\frame{
    \frametitle{Part I: Production versions}
    \tableofcontents[pausesections,part=1]
}

\frame{
    \frametitle{Part II: Research}
    \tableofcontents[part=2]
}

%%%%%%%%%%%%%%
% First part %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\part{Production versions}
\frame{\partpage}

\section{Introduction}
        \frame{
            \frametitle{What is OAR designed for}
            OAR is an open source batch/resource manager for clusters.\\
            \bigskip
            Historically: created to replace PBSpro on the Icluster (begun non free for universities).\\
            \bigskip
            OAR:
            \begin{itemize}
                \item Use OpenSSH daemon on compute nodes.
                \item Batch or interactive jobs.
                \item Gantt scheduling (with reservations).
                \item No dependence on specific computing libraries like MPI.
                \item 2 web interfaces (Monika and DrawGantt).
            \end{itemize}
        }
        \frame{
            \frametitle{What is OAR designed for}
            \begin{center}
                \includegraphics[height=40ex]{src/img/clusters_intro.png}
            \end{center}
        }
        \frame{
            \frametitle{OAR2 enhancements}
            OAR2 is a huge rewrite of the first version:
            \begin{itemize}
                \item Manage heterogeneous clusters.
                \item Solution to clean properly compute nodes.
                \item Support of dynamic nodes.
                \item Support moldable jobs.
                \item Support job types.
                \item Suspend/resume job execution.
                \item Faire sharing scheduler algorithm.
                \item ...
            \end{itemize}
        }

\section{Strong concepts}
    \subsection{Modules around a database}
        \frame{
            \frametitle{Modules around a database}
            Everything is stored in a database.\\
            This is the only way of communication between each functional modules.\\
            \begin{itemize}
                \item Advantages:
                    \begin{itemize}
                        \item Simplicity.
                        \item Choose your language to write the modules (currently in Perl).
                        \item Able to use database technologies for the replication, backup, mirroring, ...
                    \end{itemize}
                \item Drawback:
                    \begin{itemize}
                        \item Huge amount of database requests.
                    \end{itemize}
            \end{itemize}
            \bigskip
            So everything is logged and can be post-treated by other tools.
        }
        \frame{
            \frametitle{Database scheme}
            \begin{center}
                \includegraphics[height=40ex]{src/img/db_scheme.png}
            \end{center}
        }
    \subsection{Hierarchical resources}
        \frame{
            \frametitle{Resources}
                Everything is a {\Large resource}(or a set of resources):
                \begin{itemize}
                    \item compute nodes
                    \item CPUs
                    \item CPU cores
                    \item memory slots
                    \item licences (MathLab, Fluent, ...)
                    \item ...
                \end{itemize}
            By default a resource references a node.\\
            OAR2 uses these data in a hierarchical manner.
        }
        \frame{
            \frametitle{The hierarchies}
            Not only 1 hierarchy but everything the users want.\\
            Depends on what the administrator fills in the database.\\
            For example:
            \begin{itemize}
                \item nodes
                \item cpus $>$ nodes
                \item cores $>$ cpus $>$ nodes $>$ switches $>$ clusters
                \item cores $>$ switches
                \item ...
            \end{itemize}
        }
        \frame{
            \frametitle{Graphical example}
            \begin{center}
                \includegraphics[height=40ex]{src/img/hierarchical_resources.png}
            \end{center}
        }
    \subsection{oarsh}
        \frame{
            \frametitle{oarsh/oarsh\_shell}
            Wrapper around the {\Large ssh} command.\\
            Only way to connect from one compute node to an other.
            \begin{itemize}
                \item Advantages
                    \begin{itemize}
                        \item OAR manages user connections.
                        \item The users don't need anymore to configure their SSH keys.
                        \item Transfer automatically jobs information (CPUSET, user id).
                        \item Can use oarsh like ssh (for example: "-X" is working).
                        \item The users are not able to log on unreserved resources.
                    \end{itemize}
                \item Drawback
                    \begin{itemize}
                        \item The users have to use oarsh in their program to log on the nodes (replace ssh by oarsh).\\
                        {\tiny But there is a solution if it is not possible (see "job key" subsection).}
                    \end{itemize}
            \end{itemize}
        }
        \frame{
            \frametitle{CPUSETs}
            Mechanism for assigning a set of CPUs and Memory Nodes to a set of tasks.\\
            (this functionality is included in 2.6 Linux kernels)\\
            \bigskip
            OAR creates 1 CPUSET by job on each reserved nodes.\\
            Then it fills CPUs and Memory Nodes with the right value (from the database resources).\\
            \bigskip
            The CPUSET name is propagated via "oarsh" on each nodes. So the
            users cannot get out of their CPUSET during a job.
        }
        \frame{
            \frametitle{CPUSET advantages}
            \begin{itemize}
                \item Restricts the use of the Cpus and Memories.
                \item Very usefull on big NUMA nodes but not only...
                \item Keeps the list of every child processes of a job.\\
                      So it is possible to track job user forks and then to
                      clean (kill remaining processes) all the nodes after the
                      end of the job.
            \end{itemize}
            \bigskip
            {\Large This is a really huge enhancement in the OAR job clean process.}
        }
        \frame{
            \frametitle{job key}
            Concept: assign a SSH key for each OAR job.\\
            \bigskip
            \begin{itemize}
                \item The users are able to use this key to connect to all
                      nodes of their job via the {\tt normal} "ssh" command
                      ("-i" option).
                \item Grid usage: can use the same job key on 2 OAR server
                      on 2 different clusters and then connect to the whole nodes.\\
                      Once submitted with the same job key, the connections are
                      completely transparent via "oarsh".
            \end{itemize}
        }
        \frame{
            \frametitle{job temporary user}
                From now,\\
                the best container on every UNIX systems is the {\Large user id}:
            \begin{itemize}
                \item processes
                \item files
                \item sockets
                \item IPC (shared memory)
                \item ...
            \end{itemize}
        }
        \frame{
            \frametitle{job temporary user}
            Idea:
            \begin{enumerate}
                \item Add a pool of temporary user id in the resources.
                \item Reserve automatically one of these user id when submitting a new job.
                \item At the beginning of the job, just create the temporary user.
                \item At the end of the job, clean everything you want from this temporary user and then delete it.
            \end{enumerate}
            Drawbacks:
            \begin{itemize}
                \item Each user must have an unique primary group.
                \item The same temporary user id can be used by different users
                      (not at the same time). So be careful with file
                      permissions.
            \end{itemize}
            $\Rightarrow$ it depends of the distributed file system used.
        }
    \subsection{Scalability}
        \frame{
            \frametitle{Taktuk}
            External command ({\tt http://taktuk.gforge.inria.fr/}):
            \begin{itemize}
                \item Performs large scale remote execution deployment.
                \item Platform independent.
                \item Not needed to install it on compute nodes.
                \item I/O redirection
                \item Sliding window + tree diffusion (uses work-stealing) algorithm.
                \item Uses a generic connector like ssh, rsh, ... (here it is ssh).
            \end{itemize}
            Every OAR node management actions are performed via the Taktuk command.\\
        }
        \frame{
            \frametitle{Taktuk example}
            \begin{center}
                \includegraphics[height=40ex]{src/img/db_scheme.png}
            \end{center}

        }
        \frame{
            \frametitle{Scheduling}
            \begin{itemize}
                \item Every possibilities = impossible
                \item hierarchical job resource description = make the work of the scheduler easier and more scalable
            \end{itemize}
            \bigskip
            Can be implemented with another programming language.
        }

\section{Functionalities}
    \subsection{Administrator side}
        \frame{
            \frametitle{Administrator functionalities}
            \begin{itemize}
                \item Add/remove resources.
                \item Add/remove resource properties.
                \item Change property values of resources.
                \item Manage scheduling queues (priority, scheduler).
                \item Suspend/resume jobs.
                \item Change admission rules.
                \item Configure dynamic nodes (save power by switch on only right nodes and switch off the others).
            \end{itemize}
        }

    \subsection{User side}
        \frame{
            \frametitle{Monika}
            \begin{center}
                \includegraphics[height=40ex]{src/img/db_scheme.png}
            \end{center}
        }
        \frame{
            \frametitle{DrawGantt}
            \begin{center}
                \includegraphics[height=40ex]{src/img/db_scheme.png}
            \end{center}
        }
        \frame{
            \frametitle{User functionalities}
            \begin{itemize}
                \item Reservations.
                \item Moldable jobs.
                \item Timesharing.
                \item Besteffort jobs.
                \item Checkpoint notification.
                \item Change default stdout and stderr files.
                \item Job dependencies.
                \item Notification (start and end of the job).
                \begin{itemize}
                    \item Send emails.
                    \item Execute a program on the frontale.
                \end{itemize}
                \item Resubmission.
            \end{itemize}
            {\tiny All user commands have a XML, YAML and Perl DUMPER output format}
        }

    \subsection{Simple use cases}
        \frame{
            \frametitle{OAR}
            \begin{itemize}
                \item TOTO4
            \end{itemize}
        }

    \subsection{More complex use cases}
        \frame{
            \frametitle{OAR}
            \begin{itemize}
                \item TOTO4
            \end{itemize}
        }

\section{OAR2 in action}
    \frame{
        \frametitle{Current installations}
        OAR2 is ready for production and is already installed in:
        \begin{itemize}
            \item the {\large CIMENT} project ({\tt https://ciment.ujf-grenoble.fr/})\\
                  almost 500 cores in 9 different clusters
            \item the {\large GRID5000} project ({\tt https://www.grid5000.fr/})\\
                  9 sites (with 1 OAR server per site)\\
                  more than 3000 cores in 20 clusters
        \end{itemize}
    }
    \frame{
        \frametitle{Current installations}
            Unknown persons:
            \begin{itemize}
                \item from Poland ({\tt http://www.ioe.wat.edu.pl/})
                \item from ithe University of Michigan
                \item from a french bank
                \item ...
            \end{itemize}
    }
    \frame{
        \frametitle{Versioning}
        The current stable branch is the 2.2.\\
        The third digit is used to bring out only bug fix released.\\
        \bigskip
        The version under development is the 2.3.\\
        \bigskip
        Other branches can be used for research oriented experimentations.\\
        \bigskip
        For sources,Debian packages and USB live key images:\\
        \bigskip
        \hspace{4ex}{\tt http://oar.imag.fr/download.html}
    }

%%%%%%%%%%%%%%%
% Second part %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\part{Research}
\frame{\partpage}

\frame{
    \frametitle{Part II: Research}
    \tableofcontents[pausesections,part=2]
}


\section{YOPYOYPOP}
\frame{
    \frametitle{First slide}
    Yop
}

\section{YEPYEPEYEP}
\frame{
    \frametitle{Second slide}
    Yep
}

\end{document}

