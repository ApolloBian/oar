<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>OAR Documentation</title>
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:Date: $Date$
:Revision: $Revision$
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

tt.docutils {
  background-color: #eeeeee }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="oar-documentation">
<h1 class="title">OAR Documentation</h1>
<div align="center" class="align-center"><img alt="../oar_logo.png" class="align-center" src="../oar_logo.png" /></div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Capit Nicolas</td>
</tr>
<tr class="field"><th class="field-name">Address:</th><td class="field-body">Laboratoire Informatique et Distribution (ID)-IMAG
ENSIMAG - antenne de Montbonnot
ZIRST 51, avenue Jean Kuntzmann
38330 MONTBONNOT SAINT MARTIN</td>
</tr>
<tr class="field"><th class="field-name">Contact:</th><td class="field-body"><a class="reference" href="mailto:nicolas.capit&#64;imag.fr">nicolas.capit&#64;imag.fr</a></td>
</tr>
<tr class="field"><th class="field-name">Authors:</th><td class="field-body">ID laboratory</td>
</tr>
<tr class="field"><th class="field-name">organization:</th><td class="field-body">ID laboratory</td>
</tr>
<tr class="field"><th class="field-name">status:</th><td class="field-body">This is a &quot;work in progress&quot;</td>
</tr>
<tr class="field"><th class="field-name">license:</th><td class="field-body">GNU GENERAL PUBLIC LICENSE</td>
</tr>
<tr class="field"><th class="field-name">Dedication:</th><td class="field-body">For users, administrators and developpers.</td>
</tr>
<tr class="field"><th class="field-name">abstract:</th><td class="field-body">OAR is a resource manager or (batch scheduler) for large clusters. In
functionnalities, it's near of PBS, LSF, CCS and Condor. It's suitable for
productive plateforms and research experiments.</td>
</tr>
</tbody>
</table>
<div class="contents topic">
<p class="topic-title first"><a id="table-of-contents" name="table-of-contents">Table of Contents</a></p>
<ul class="auto-toc simple">
<li><a class="reference" href="#installing-the-oar-batch-system" id="id2" name="id2">1&nbsp;&nbsp;&nbsp;Installing the OAR batch system</a><ul class="auto-toc">
<li><a class="reference" href="#requirements" id="id3" name="id3">1.1&nbsp;&nbsp;&nbsp;Requirements</a></li>
<li><a class="reference" href="#configuration-of-the-cluster" id="id4" name="id4">1.2&nbsp;&nbsp;&nbsp;Configuration of the cluster</a><ul class="auto-toc">
<li><a class="reference" href="#cpuset-installation" id="id5" name="id5">1.2.1&nbsp;&nbsp;&nbsp;CPUSET installation</a><ul class="auto-toc">
<li><a class="reference" href="#what-are-oarsh-and-oarsh-shell-scripts" id="id6" name="id6">1.2.1.1&nbsp;&nbsp;&nbsp;What are &quot;oarsh&quot; and &quot;oarsh_shell&quot; scripts?</a></li>
<li><a class="reference" href="#cpuset-definition" id="id7" name="id7">1.2.1.2&nbsp;&nbsp;&nbsp;CPUSET definition</a></li>
<li><a class="reference" href="#oarsh" id="id8" name="id8">1.2.1.3&nbsp;&nbsp;&nbsp;OARSH</a></li>
<li><a class="reference" href="#oarsh-shell" id="id9" name="id9">1.2.1.4&nbsp;&nbsp;&nbsp;OARSH_SHELL</a></li>
<li><a class="reference" href="#notes" id="id10" name="id10">1.2.1.5&nbsp;&nbsp;&nbsp;NOTES</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#visualization-tools-installation" id="id11" name="id11">1.3&nbsp;&nbsp;&nbsp;Visualization tools installation</a></li>
<li><a class="reference" href="#starting" id="id12" name="id12">1.4&nbsp;&nbsp;&nbsp;Starting</a></li>
<li><a class="reference" href="#further-information" id="id13" name="id13">1.5&nbsp;&nbsp;&nbsp;Further information</a></li>
</ul>
</li>
<li><a class="reference" href="#user-guide" id="id14" name="id14">2&nbsp;&nbsp;&nbsp;User guide</a><ul class="auto-toc">
<li><a class="reference" href="#description-of-the-different-commands" id="id15" name="id15">2.1&nbsp;&nbsp;&nbsp;Description of the different commands</a><ul class="auto-toc">
<li><a class="reference" href="#oarstat" id="id16" name="id16">2.1.1&nbsp;&nbsp;&nbsp;<em>oarstat</em></a></li>
<li><a class="reference" href="#oarnodes" id="id17" name="id17">2.1.2&nbsp;&nbsp;&nbsp;<em>oarnodes</em></a></li>
<li><a class="reference" href="#oarsub" id="id18" name="id18">2.1.3&nbsp;&nbsp;&nbsp;<em>oarsub</em></a></li>
<li><a class="reference" href="#oardel" id="id19" name="id19">2.1.4&nbsp;&nbsp;&nbsp;<em>oardel</em></a></li>
<li><a class="reference" href="#oarhold" id="id20" name="id20">2.1.5&nbsp;&nbsp;&nbsp;<em>oarhold</em></a></li>
<li><a class="reference" href="#oarresume" id="id21" name="id21">2.1.6&nbsp;&nbsp;&nbsp;<em>oarresume</em></a></li>
</ul>
</li>
<li><a class="reference" href="#visualisation-tools" id="id22" name="id22">2.2&nbsp;&nbsp;&nbsp;Visualisation tools</a><ul class="auto-toc">
<li><a class="reference" href="#monika" id="id23" name="id23">2.2.1&nbsp;&nbsp;&nbsp;Monika</a></li>
<li><a class="reference" href="#drawoargantt" id="id24" name="id24">2.2.2&nbsp;&nbsp;&nbsp;DrawOARGantt</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#administrator-guide" id="id25" name="id25">3&nbsp;&nbsp;&nbsp;Administrator guide</a><ul class="auto-toc">
<li><a class="reference" href="#administrator-commands" id="id26" name="id26">3.1&nbsp;&nbsp;&nbsp;Administrator commands</a><ul class="auto-toc">
<li><a class="reference" href="#oarproperty" id="id27" name="id27">3.1.1&nbsp;&nbsp;&nbsp;<em>oarproperty</em></a></li>
<li><a class="reference" href="#oarnodesetting" id="id28" name="id28">3.1.2&nbsp;&nbsp;&nbsp;<em>oarnodesetting</em></a></li>
<li><a class="reference" href="#oarremoveresource" id="id29" name="id29">3.1.3&nbsp;&nbsp;&nbsp;<em>oarremoveresource</em></a></li>
<li><a class="reference" href="#oaraccounting" id="id30" name="id30">3.1.4&nbsp;&nbsp;&nbsp;<em>oaraccounting</em></a></li>
<li><a class="reference" href="#oarnotify" id="id31" name="id31">3.1.5&nbsp;&nbsp;&nbsp;<em>oarnotify</em></a></li>
</ul>
</li>
<li><a class="reference" href="#database-scheme" id="id32" name="id32">3.2&nbsp;&nbsp;&nbsp;Database scheme</a><ul class="auto-toc">
<li><a class="reference" href="#accounting" id="id33" name="id33">3.2.1&nbsp;&nbsp;&nbsp;<em>accounting</em></a></li>
<li><a class="reference" href="#admission-rules" id="id34" name="id34">3.2.2&nbsp;&nbsp;&nbsp;<em>admission_rules</em></a></li>
<li><a class="reference" href="#event-logs" id="id35" name="id35">3.2.3&nbsp;&nbsp;&nbsp;<em>event_logs</em></a></li>
<li><a class="reference" href="#event-log-hostnames" id="id36" name="id36">3.2.4&nbsp;&nbsp;&nbsp;<em>event_log_hostnames</em></a></li>
<li><a class="reference" href="#files" id="id37" name="id37">3.2.5&nbsp;&nbsp;&nbsp;<em>files</em></a></li>
<li><a class="reference" href="#frag-jobs" id="id38" name="id38">3.2.6&nbsp;&nbsp;&nbsp;<em>frag_jobs</em></a></li>
<li><a class="reference" href="#gantt-jobs-resources" id="id39" name="id39">3.2.7&nbsp;&nbsp;&nbsp;<em>gantt_jobs_resources</em></a></li>
<li><a class="reference" href="#gantt-jobs-resources-visu" id="id40" name="id40">3.2.8&nbsp;&nbsp;&nbsp;<em>gantt_jobs_resources_visu</em></a></li>
<li><a class="reference" href="#gantt-jobs-predictions" id="id41" name="id41">3.2.9&nbsp;&nbsp;&nbsp;<em>gantt_jobs_predictions</em></a></li>
<li><a class="reference" href="#gantt-jobs-predictions-visu" id="id42" name="id42">3.2.10&nbsp;&nbsp;&nbsp;<em>gantt_jobs_predictions_visu</em></a></li>
<li><a class="reference" href="#jobs" id="id43" name="id43">3.2.11&nbsp;&nbsp;&nbsp;<em>jobs</em></a></li>
<li><a class="reference" href="#job-dependencies" id="id44" name="id44">3.2.12&nbsp;&nbsp;&nbsp;<em>job_dependencies</em></a></li>
<li><a class="reference" href="#moldable-job-descriptions" id="id45" name="id45">3.2.13&nbsp;&nbsp;&nbsp;<em>moldable_job_descriptions</em></a></li>
<li><a class="reference" href="#job-resource-groups" id="id46" name="id46">3.2.14&nbsp;&nbsp;&nbsp;<em>job_resource_groups</em></a></li>
<li><a class="reference" href="#job-resource-descriptions" id="id47" name="id47">3.2.15&nbsp;&nbsp;&nbsp;<em>job_resource_descriptions</em></a></li>
<li><a class="reference" href="#job-state-logs" id="id48" name="id48">3.2.16&nbsp;&nbsp;&nbsp;<em>job_state_logs</em></a></li>
<li><a class="reference" href="#job-types" id="id49" name="id49">3.2.17&nbsp;&nbsp;&nbsp;<em>job_types</em></a></li>
<li><a class="reference" href="#resources" id="id50" name="id50">3.2.18&nbsp;&nbsp;&nbsp;<em>resources</em></a></li>
<li><a class="reference" href="#resource-state-logs" id="id51" name="id51">3.2.19&nbsp;&nbsp;&nbsp;<em>resource_state_logs</em></a></li>
<li><a class="reference" href="#resource-properties" id="id52" name="id52">3.2.20&nbsp;&nbsp;&nbsp;<em>resource_properties</em></a></li>
<li><a class="reference" href="#resource-property-logs" id="id53" name="id53">3.2.21&nbsp;&nbsp;&nbsp;<em>resource_property_logs</em></a></li>
<li><a class="reference" href="#assigned-resources" id="id54" name="id54">3.2.22&nbsp;&nbsp;&nbsp;<em>assigned_resources</em></a></li>
<li><a class="reference" href="#queues" id="id55" name="id55">3.2.23&nbsp;&nbsp;&nbsp;<em>queues</em></a></li>
<li><a class="reference" href="#challenges" id="id56" name="id56">3.2.24&nbsp;&nbsp;&nbsp;<em>challenges</em></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#configuration-file" id="id57" name="id57">4&nbsp;&nbsp;&nbsp;Configuration file</a></li>
<li><a class="reference" href="#module-descriptions" id="id58" name="id58">5&nbsp;&nbsp;&nbsp;Module descriptions</a><ul class="auto-toc">
<li><a class="reference" href="#almighty" id="id59" name="id59">5.1&nbsp;&nbsp;&nbsp;Almighty</a></li>
<li><a class="reference" href="#sarko" id="id60" name="id60">5.2&nbsp;&nbsp;&nbsp;Sarko</a></li>
<li><a class="reference" href="#judas" id="id61" name="id61">5.3&nbsp;&nbsp;&nbsp;Judas</a></li>
<li><a class="reference" href="#leon" id="id62" name="id62">5.4&nbsp;&nbsp;&nbsp;Leon</a></li>
<li><a class="reference" href="#nodechangestate" id="id63" name="id63">5.5&nbsp;&nbsp;&nbsp;NodeChangeState</a></li>
<li><a class="reference" href="#scheduler" id="id64" name="id64">5.6&nbsp;&nbsp;&nbsp;Scheduler</a></li>
<li><a class="reference" href="#runner" id="id65" name="id65">5.7&nbsp;&nbsp;&nbsp;Runner</a></li>
</ul>
</li>
<li><a class="reference" href="#mechanisms" id="id66" name="id66">6&nbsp;&nbsp;&nbsp;Mechanisms</a><ul class="auto-toc">
<li><a class="reference" href="#how-does-an-interactive-oarsub-work" id="id67" name="id67">6.1&nbsp;&nbsp;&nbsp;How does an interactive <em>oarsub</em> work?</a></li>
<li><a class="reference" href="#cpuset" id="id68" name="id68">6.2&nbsp;&nbsp;&nbsp;CPUSET</a></li>
<li><a class="reference" href="#job-launch" id="id69" name="id69">6.3&nbsp;&nbsp;&nbsp;Job launch</a></li>
<li><a class="reference" href="#job-deletion" id="id70" name="id70">6.4&nbsp;&nbsp;&nbsp;Job deletion</a></li>
<li><a class="reference" href="#checkpoint" id="id71" name="id71">6.5&nbsp;&nbsp;&nbsp;Checkpoint</a></li>
<li><a class="reference" href="#scheduling" id="id72" name="id72">6.6&nbsp;&nbsp;&nbsp;Scheduling</a></li>
<li><a class="reference" href="#user-notification" id="id73" name="id73">6.7&nbsp;&nbsp;&nbsp;User notification</a></li>
<li><a class="reference" href="#id1" id="id74" name="id74">6.8&nbsp;&nbsp;&nbsp;Accounting</a></li>
</ul>
</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id2" id="installing-the-oar-batch-system" name="installing-the-oar-batch-system">1&nbsp;&nbsp;&nbsp;Installing the OAR batch system</a></h1>
<dl class="docutils">
<dt>What do you need?</dt>
<dd><ul class="first last simple">
<li>a cluster</li>
<li>to be an admin of this cluster</li>
<li>to get the install package of OAR (normally you have already done that)</li>
</ul>
</dd>
</dl>
<div class="section">
<h2><a class="toc-backref" href="#id3" id="requirements" name="requirements">1.1&nbsp;&nbsp;&nbsp;Requirements</a></h2>
<p>There a three kinds of nodes, each requiring a specific software configuration.</p>
<p>These are :</p>
<blockquote>
<ul class="simple">
<li>the server node, which will hold all of OAR &quot;smartness&quot; ;</li>
<li>the login nodes, on which you will be allowed to login, then reserve some
computational nodes ;</li>
<li>the computational nodes (a.k.a. the nodes), on which the jobs will run.</li>
</ul>
</blockquote>
<p>On every node, the &quot;sentinelle&quot; binary can be installed (it is not necessary).
This tool is used to launch commands on several computers, at a same time.
It ships with the current OAR package (but it is also available
separately in Taktuk in an Open Source License).</p>
<p>On every nodes (server, login, computational), the following packages must be
installed :</p>
<blockquote>
<ul class="simple">
<li>sudo</li>
<li>Perl</li>
<li>Perl-base</li>
<li>openssh (server and client)</li>
</ul>
</blockquote>
<p>On the OAR server and on the login nodes, the following packages must be
installed:</p>
<blockquote>
<ul class="simple">
<li>Perl-Mysql</li>
<li>Perl-DBI</li>
<li>MySQL</li>
<li>MySQL-shared</li>
<li>libmysql</li>
</ul>
</blockquote>
<p>From now on, we will suppose all the Perl/Mysql packages are
correctly installed and configured and mysql database is started.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id4" id="configuration-of-the-cluster" name="configuration-of-the-cluster">1.2&nbsp;&nbsp;&nbsp;Configuration of the cluster</a></h2>
<p>The following steps have to be done, prior to installing OAR:</p>
<blockquote>
<ul>
<li><p class="first">add a user named &quot;oar&quot; in the group &quot;oar&quot; on every node</p>
</li>
<li><p class="first">let the user &quot;oar&quot; connect through ssh from any node to any node WITHOUT
password. To achieve this, here is some standard procedure for OpenSSH:</p>
<blockquote>
<ul>
<li><p class="first">create a set of ssh keys for the user &quot;oar&quot; with ssh-keygen (for
instance 'id_dsa.pub' and 'id_dsa')</p>
</li>
<li><p class="first">copy these keys on each node of the cluster in the &quot;.ssh&quot; folder of
the user &quot;oar&quot;</p>
</li>
<li><p class="first">append the contents of 'id_dsa.pub' to the file
&quot;~/.ssh/authorized_keys&quot;</p>
</li>
<li><p class="first">in &quot;~/.ssh/config&quot; add the lines:</p>
<pre class="literal-block">
Host *
    ForwardX11 no
    StrictHostKeyChecking no
    PasswordAuthentication no
    AddressFamily inet
</pre>
</li>
<li><p class="first">test the ssh connection between (every) two nodes : there should not
be any prompt.</p>
</li>
</ul>
</blockquote>
</li>
<li><p class="first">grant the user &quot;oar&quot; the permission to execute commands with root
privileges. To achieve that, OAR makes use of sudo. As a consequence,
/etc/sudoers must be configured. Please use visudo to add the following
lines:</p>
<pre class="literal-block">
Defaults&gt;oar    env_reset,env_keep = &quot;OARUSER OARDIR PWD PERL5LIB OARCONFFILE&quot;
Cmnd_Alias OARCMD = /usr/lib/oar/oarnodes, /usr/lib/oar/oarstat,\
/usr/lib/oar/oarsub, /usr/lib/oar/oardel, /usr/lib/oar/oarhold,\
/usr/lib/oar/oarnotify, /usr/lib/oar/oarresume
%oar ALL=(oar) NOPASSWD: OARCMD
oar ALL=(ALL) NOPASSWD:ALL
www-data ALL=(oar) NOPASSWD: /usr/lib/oar/oar-cgi
</pre>
</li>
</ul>
</blockquote>
<p>There are a three different flavors of installation :</p>
<blockquote>
<ul class="simple">
<li>server:  install the daemon which must be running on the server</li>
<li>user:    install all the tools needed to submit and manage jobs for the
users (oarsub, oarstat, oarnodes, ...)</li>
<li>node:    install the tools for a computing node</li>
</ul>
</blockquote>
<p>The installation is straightforward:</p>
<blockquote>
<ul>
<li><p class="first">become root</p>
</li>
<li><p class="first">go to OAR source repository</p>
</li>
<li><p class="first">You can set Makefile variables in the command line to suit your configuration
(change &quot;OARHOMEDIR&quot; to the home of your user oar and &quot;PREFIX&quot; where you want
to copy all OAR files).</p>
</li>
<li><dl class="first docutils">
<dt>run make  &lt;module&gt; [module] ...</dt>
<dd><dl class="first last docutils">
<dt>where module := { server-install | user-install | node-install | doc-install | debian-package }</dt>
<dd><p class="first last">OPTIONS := { OARHOMEDIR | OARCONFDIR | OARUSER | PREFIX | MANDIR | OARDIR | BINDIR | SBINDIR | DOCDIR }</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><p class="first">Edit /etc/oar.conf file to match your cluster configuration.</p>
</li>
<li><p class="first">Make sure that the PATH environnement variable contains $PREFIX/$BINDIR of
your installation (default is /usr/local/bin).</p>
</li>
</ul>
</blockquote>
<p>Initialization of OAR database (MySQL) is achieved using oar_db_init.pl script provided
with the server module installation and located in $PREFIX/sbin (/usr/local/sbin in default Makefile).</p>
<p>The same machine may host several or even all modules.</p>
<p>Note about X11:
The easiest and scalable way to use X11 application on cluster nodes is to open X11 ports and set the right DISPLAY environment variable by hand.</p>
<p>Otherwise users can use X11 forwarding via ssh to access cluster frontal. After that you must configure ssh server on this frontal with</p>
<blockquote>
X11Forwarding yes
X11UseLocalhost no</blockquote>
<p>With this configuration, users can launch X11 applications after a 'oarsub -I' on the given node.</p>
<div class="section">
<h3><a class="toc-backref" href="#id5" id="cpuset-installation" name="cpuset-installation">1.2.1&nbsp;&nbsp;&nbsp;CPUSET installation</a></h3>
<!-- OAR can use CPUSET features provided with the Linux kernel >= 2.6. This enables
to restrict user processes only on reserved processors and clean correctly nodes
after the job.
To perform this installation you must read the documentation in Tools/oarsh/README. -->
<div class="section">
<h4><a class="toc-backref" href="#id6" id="what-are-oarsh-and-oarsh-shell-scripts" name="what-are-oarsh-and-oarsh-shell-scripts">1.2.1.1&nbsp;&nbsp;&nbsp;What are &quot;oarsh&quot; and &quot;oarsh_shell&quot; scripts?</a></h4>
<p>&quot;oarsh&quot; and &quot;oarsh_shell&quot; are two scripts that can restrict user processes to
stay in the same cpuset on all nodes.</p>
<p>This feature is very usefull to restrict processor consumption on
multiprocessors computers and to kill all processes of a same
OAR job on several nodes.</p>
</div>
<div class="section">
<h4><a class="toc-backref" href="#id7" id="cpuset-definition" name="cpuset-definition">1.2.1.2&nbsp;&nbsp;&nbsp;CPUSET definition</a></h4>
<p>CPUSET is a module integrated in the Linux kernel since 2.6.x.
In the kernel documentation, you can read:</p>
<pre class="literal-block">
Cpusets provide a mechanism for assigning a set of CPUs and Memory
Nodes to a set of tasks.

Cpusets constrain the CPU and Memory placement of tasks to only
the resources within a tasks current cpuset.  They form a nested
hierarchy visible in a virtual file system.  These are the essential
hooks, beyond what is already present, required to manage dynamic
job placement on large systems.

Each task has a pointer to a cpuset.  Multiple tasks may reference
the same cpuset.  Requests by a task, using the sched_setaffinity(2)
system call to include CPUs in its CPU affinity mask, and using the
mbind(2) and set_mempolicy(2) system calls to include Memory Nodes
in its memory policy, are both filtered through that tasks cpuset,
filtering out any CPUs or Memory Nodes not in that cpuset.  The
scheduler will not schedule a task on a CPU that is not allowed in
its cpus_allowed vector, and the kernel page allocator will not
allocate a page on a node that is not allowed in the requesting tasks
mems_allowed vector.

If a cpuset is cpu or mem exclusive, no other cpuset, other than a direct
ancestor or descendent, may share any of the same CPUs or Memory Nodes.
A cpuset that is cpu exclusive has a sched domain associated with it.
The sched domain consists of all cpus in the current cpuset that are not
part of any exclusive child cpusets.
This ensures that the scheduler load balacing code only balances
against the cpus that are in the sched domain as defined above and not
all of the cpus in the system. This removes any overhead due to
load balancing code trying to pull tasks outside of the cpu exclusive
cpuset only to be prevented by the tasks' cpus_allowed mask.

A cpuset that is mem_exclusive restricts kernel allocations for
page, buffer and other data commonly shared by the kernel across
multiple users.  All cpusets, whether mem_exclusive or not, restrict
allocations of memory for user space.  This enables configuring a
system so that several independent jobs can share common kernel
data, such as file system pages, while isolating each jobs user
allocation in its own cpuset.  To do this, construct a large
mem_exclusive cpuset to hold all the jobs, and construct child,
non-mem_exclusive cpusets for each individual job.  Only a small
amount of typical kernel memory, such as requests from interrupt
handlers, is allowed to be taken outside even a mem_exclusive cpuset.

User level code may create and destroy cpusets by name in the cpuset
virtual file system, manage the attributes and permissions of these
cpusets and which CPUs and Memory Nodes are assigned to each cpuset,
specify and query to which cpuset a task is assigned, and list the
task pids assigned to a cpuset.
</pre>
</div>
<div class="section">
<h4><a class="toc-backref" href="#id8" id="oarsh" name="oarsh">1.2.1.3&nbsp;&nbsp;&nbsp;OARSH</a></h4>
<p>&quot;oarsh&quot; is a wrapper around the &quot;ssh&quot; command (tested with openSSH).
Its goal is to propagate two environment variables:</p>
<blockquote>
<ul class="simple">
<li>OAR_CPUSET : The name of the OAR job cpuset</li>
<li>SUDO_USER : The name of the user who has launched oarsh command</li>
</ul>
</blockquote>
<p>So &quot;oarsh&quot; must be run by oar and a simple user must run it via the
&quot;sudowrapper&quot; script to become oar.
In this way each cluster user who can execute &quot;oarsh&quot; via &quot;sudowrapper can
connect himself on each cluster nodes (if oarsh is installed everywhere).</p>
</div>
<div class="section">
<h4><a class="toc-backref" href="#id9" id="oarsh-shell" name="oarsh-shell">1.2.1.4&nbsp;&nbsp;&nbsp;OARSH_SHELL</a></h4>
<p>&quot;oarsh_shell&quot; must be the shell of the oar user on each nodes where you want
oarsh to worked.
This script takes &quot;OAR_CPUSET&quot; and &quot;SUDO_USER&quot; environment variables and
adds its PID in OAR_CPUSET cpuset. Then it searchs user shell and home and
executes the right command (like ssh).</p>
</div>
<div class="section">
<h4><a class="toc-backref" href="#id10" id="notes" name="notes">1.2.1.5&nbsp;&nbsp;&nbsp;NOTES</a></h4>
<blockquote>
<ul>
<li><p class="first">On each nodes you must add the line:</p>
<pre class="literal-block">
AcceptEnv OAR_CPUSET SUDO_USER
</pre>
<p>In Debian the file is &quot;/etc/ssh/sshd_config&quot;</p>
</li>
<li><p class="first">You can use scp with oarsh. The syntax is:</p>
<pre class="literal-block">
scp -S /path/to/oarsh ...
</pre>
</li>
<li><p class="first">You can restrict the use of oarsh with the sudo configuration:</p>
<pre class="literal-block">
%oarsh ALL=(oar) NOPASSWD: /path/to/oarsh
</pre>
<p>Here only users from oarsh group can execute oarsh</p>
</li>
</ul>
</blockquote>
</div>
</div>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id11" id="visualization-tools-installation" name="visualization-tools-installation">1.3&nbsp;&nbsp;&nbsp;Visualization tools installation</a></h2>
<p>There are two different tools. One, named Monika, displays the current cluster state
with all active and waiting jobs. The other, named DrawOARGantt, diplays node occupation
in a lapse of time.
These tools are CGI scripts and generate HTML pages.</p>
<dl class="docutils">
<dt>You can install these in this way:</dt>
<dd><p class="first">DrawOARGantt:</p>
<blockquote>
<ul>
<li><p class="first">Make sure you installed &quot;perl-GD&quot; and &quot;perl-GD-Text-Util&quot; packages.</p>
</li>
<li><p class="first">Copy &quot;DrawOARGantt.pl&quot; and &quot;DrawGantt.conf&quot; in the CGI folder of your web server
(ex: /usr/lib/cgi-bin/ for Debian).</p>
</li>
<li><p class="first">Copy all icons and javascript files in a folder that web server can find them
(ex: /var/www/oar/Icons and /var/www/oar/Icons).</p>
</li>
<li><p class="first">Make sure that these files can be read by web server user.</p>
</li>
<li><p class="first">Edit &quot;DrawGantt.conf&quot; and change tags:</p>
<blockquote>
<ul class="simple">
<li>&quot;oarstatCmd&quot; --&gt; path of oarstat command (ex: oarstat).</li>
<li>&quot;path_cache_directory&quot; --&gt; directory where images will be stored (ex: /var/www/oar/tmp/).</li>
<li>&quot;web_cache_directory&quot; --&gt; this path corresponds of &quot;path_cache_directory&quot; in the web server repository (ex: /oar/tmp/).</li>
<li>&quot;web_icons_directory&quot; --&gt; web server path where CGI can find icon files (ex: /oar/Icons/).</li>
<li>&quot;web_path_js_directory&quot; --&gt; web server path where CGI can find the javascript file (ex: /oar/js/).</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p>Monika:</p>
<blockquote class="last">
<ul class="simple">
<li>The package &quot;perl-AppConfig&quot; is required.</li>
<li>Read INSTALL file in the monika repository.</li>
</ul>
</blockquote>
</dd>
</dl>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id12" id="starting" name="starting">1.4&nbsp;&nbsp;&nbsp;Starting</a></h2>
<p>First, you must start OAR daemon on the server (its name is &quot;Almighty&quot;).</p>
<blockquote>
<ul class="simple">
<li>if you have installed OAR from sources, become oar user and launch command
&quot;Almighty&quot; (it stands in $PREFIX/sbin).</li>
<li>if you have installed OAR from Debian packages, use the script
&quot;/etc/init.d/oar-server&quot; to start the daemon.</li>
</ul>
</blockquote>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id13" id="further-information" name="further-information">1.5&nbsp;&nbsp;&nbsp;Further information</a></h2>
<p>For further information, please check <a class="reference" href="http://oar.imag.fr/">http://oar.imag.fr/</a>.</p>
<!-- $Id: INSTALL,v 1.23 2005/09/27 13:59:34 capitn Exp $ -->
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id14" id="user-guide" name="user-guide">2&nbsp;&nbsp;&nbsp;User guide</a></h1>
<div class="section">
<h2><a class="toc-backref" href="#id15" id="description-of-the-different-commands" name="description-of-the-different-commands">2.1&nbsp;&nbsp;&nbsp;Description of the different commands</a></h2>
<p>All user commands are installed on cluster login nodes. So you must connect to
one of these computers first.</p>
<div class="section">
<h3><a class="toc-backref" href="#id16" id="oarstat" name="oarstat">2.1.1&nbsp;&nbsp;&nbsp;<em>oarstat</em></a></h3>
<p>This command prints jobs in execution mode on the terminal.</p>
<p>Options</p>
<pre class="literal-block">
-f        : prints each job in full details
-j job_id : prints the specified job_id informations (even if it is finished)
-g &quot;d1,d2&quot;: prints history of jobs and state of resources between two dates.
-D        : formats outputs in Perl Dumper
-X        : formats outputs in XML
-Y        : formats outputs in YAML
</pre>
<p>Examples</p>
<pre class="literal-block">
# oarstat
# oarstat -j 42 -f
</pre>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id17" id="oarnodes" name="oarnodes">2.1.2&nbsp;&nbsp;&nbsp;<em>oarnodes</em></a></h3>
<p>This command prints informations about cluster resources (state, which jobs on
which resources, resource properties, ...).</p>
<p>Options</p>
<pre class="literal-block">
-a : shows all resources with their properties
-s : shows only resource states
-l : shows only resource list
-D : formats outputs in Perl Dumper
-X : formats outputs in XML
-Y : formats outputs in YAML
</pre>
<p>Examples</p>
<pre class="literal-block">
# oarnodes
# oarnodes -s
</pre>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id18" id="oarsub" name="oarsub">2.1.3&nbsp;&nbsp;&nbsp;<em>oarsub</em></a></h3>
<p>The user can submit a job with this command. So, what is a job in our context?</p>
<blockquote>
<p>A job is defined by needed resources and a script/program to run. So, the user
must specify how many resources and what kind of them are needed by his
application. Thus, OAR system will give him or not what he wants and will
control the execution. When a job is launched, OAR executes user program only
on the first reservation node. So this program can access some environnement
variables to know its environnement:</p>
<pre class="literal-block">
$OAR_NODEFILE                 contains the name of a file which lists all reserved nodes for this job
$OAR_JOBID                    contains the OAR job identificator
$OAR_RESOURCE_PROPERTIES_FILE contains the name of a file which lists all resources and their properties
$OAR_NB_NODES                 contains the number of reserved nodes
</pre>
</blockquote>
<p>Options:</p>
<pre class="literal-block">
-q &quot;queuename&quot; : specify the queue for this job
-I : turn on INTERACTIVE mode (OAR gives you a shell instead of executing a script)
-l &quot;resource description&quot; : defines resource list requested for this job;
                            the different parameters are resource properties
                            registered in OAR database; see examples below.
                            (walltime : Request maximun time. Format is
                            [hour:mn:sec|hour:mn|hour]; after this elapsed time,
                            the job will be killed)
-p &quot;properties&quot; : adds constraints for the job
                  (format is a WHERE clause from the SQL syntax)
-r &quot;2007-05-11 23:32:03&quot; : asks for a reservation job to begin at the date in argument
-C job_id : connects to a reservation in Running state
-k &quot;duration&quot; : asks OAR to send the checkpoint signal to the first processus
                of the job &quot;number_of_seconds&quot; before the walltime
--signal &quot;signal name&quot; : specify the signal to use when checkpointing
-t &quot;type name&quot; : specify a specific type (deploy, besteffort, cosystem, checkpoint)
-d &quot;directory path&quot; : specify the directory where to launch the command
                      (default is current directory)
-n &quot;job name&quot; :  specify an arbitrary name for the job
-a job_id : anterior job that must be terminated to start this new one
--notify &quot;method&quot; : specify a notification method(mail or program to launch); ex:
                    --notify &quot;mail:name&#64;domain.com&quot;
                    --notify &quot;exec:/path/to/script args&quot;
--stdout &quot;file name&quot; : specify the name of the standard output file
--stderr &quot;file name&quot; : specify the name of the error output file
--resubmit job_id : resubmit the given job to a new one
--force_cpuset_name &quot;cpuset name&quot; : Instead of using job_id for the cpuset name you
                                    can specify one (WARNING: if several jobs have the
                                    same cpuset name then processes of a job could be
                                    killed when another finished on the same computer)
</pre>
<p>Examples</p>
<pre class="literal-block">
# oarsub -l /node=4 test.sh
</pre>
<p>(the &quot;test.sh&quot; script will be run on 4 entire nodes in the default queue with
the default walltime)</p>
<pre class="literal-block">
# oarsub -q default -l walltime=50:30:00,/node=10/cpu=3,walltime=2:15:00 -p &quot;switch = 'sw1'&quot; /home/users/toto/prog
</pre>
<p>(the &quot;/home/users/toto/prog&quot; script will be run on 10 nodes with 3 cpus (so a total of 30 cpus) in the default
queue with a walltime of  2:15:00. Mooreover &quot;-p&quot; option restricts resources only on the switch 'sw1')</p>
<pre class="literal-block">
# oarsub -r &quot;2004-04-27 11:00:00&quot; -l /node=12/cpu=2
</pre>
<p>(a reservation will begin at &quot;2004-04-27 11:00:00&quot; on 12 nodes with 2 cpus on each one)</p>
<pre class="literal-block">
#  oarsub -C 42
</pre>
<p>(connects to the job 42 on the first node and set all OAR environment variables)</p>
<pre class="literal-block">
# oarsub -I
</pre>
<p>(gives a shell on a resource)</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id19" id="oardel" name="oardel">2.1.4&nbsp;&nbsp;&nbsp;<em>oardel</em></a></h3>
<p>This command is used to delete or checkpoint job(s). Jobs are designed by their job's identifier.</p>
<p>Option</p>
<pre class="literal-block">
-c job_id : send checkpoint signal to the job (signal was definedwith &quot;--signal&quot; option in oarsub)
</pre>
<p>Exemples</p>
<pre class="literal-block">
# oardel 14 42
</pre>
<p>(delete jobs 14 and 42)</p>
<pre class="literal-block">
# oardel -c 42
</pre>
<p>(send checkpoint signal to the job 42)</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id20" id="oarhold" name="oarhold">2.1.5&nbsp;&nbsp;&nbsp;<em>oarhold</em></a></h3>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id21" id="oarresume" name="oarresume">2.1.6&nbsp;&nbsp;&nbsp;<em>oarresume</em></a></h3>
</div>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id22" id="visualisation-tools" name="visualisation-tools">2.2&nbsp;&nbsp;&nbsp;Visualisation tools</a></h2>
<div class="section">
<h3><a class="toc-backref" href="#id23" id="monika" name="monika">2.2.1&nbsp;&nbsp;&nbsp;Monika</a></h3>
<p>This is a web cgi normally installed on the cluster frontal. This tool executes
<em>oarnodes</em> and <em>oarstat</em> then format data in a html page.</p>
<p>Thus you can have a global view of cluster state and where your jobs are running.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id24" id="drawoargantt" name="drawoargantt">2.2.2&nbsp;&nbsp;&nbsp;DrawOARGantt</a></h3>
<p>This is also a web cgi. It creates a Gantt chart which shows job repartition on
nodes in the time. It is very usefull to see cluster occupation in the past
and to know when a job will be launched in the futur.</p>
</div>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id25" id="administrator-guide" name="administrator-guide">3&nbsp;&nbsp;&nbsp;Administrator guide</a></h1>
<div class="section">
<h2><a class="toc-backref" href="#id26" id="administrator-commands" name="administrator-commands">3.1&nbsp;&nbsp;&nbsp;Administrator commands</a></h2>
<div class="section">
<h3><a class="toc-backref" href="#id27" id="oarproperty" name="oarproperty">3.1.1&nbsp;&nbsp;&nbsp;<em>oarproperty</em></a></h3>
<p>This command manages OAR resource properties stored in the database.</p>
<p>Options are:</p>
<pre class="literal-block">
-l : list properties
-a NAME : add a property
  -c : sql new field of type VARCHAR(255) (default is integer)
-d NAME : delete a property
-r &quot;OLD_NAME,NEW_NAME&quot; : rename property OLD_NAME into NEW_NAME
</pre>
<p>Examples:</p>
<pre class="literal-block">
# oarproperty -a cpu_freq
# oarproperty -a type
# oarproperty -r &quot;cpu_freq,freq&quot;
</pre>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id28" id="oarnodesetting" name="oarnodesetting">3.1.2&nbsp;&nbsp;&nbsp;<em>oarnodesetting</em></a></h3>
<p>This command permits to change the state or a property of a node or of several
resources resources.</p>
<p>By default the node name used by <em>oarnodesetting</em> is the result of the command
<em>hostname</em>.</p>
<p>Options are:</p>
<pre class="literal-block">
-a : add a new resource
-s : state to assign to the node:
   * &quot;Alive&quot; : a job can be run on the node.
   * &quot;Absent&quot; : administrator wants to remove the node from the pool for a moment.
   * &quot;Dead&quot; : the node will not be used and will be deleted.
-h : specify the node name (override hostname).
-r : specify the resource number
-p : change the value of a property specified resources.
-n : specify this option if you do not want to wait the end of jobs running
     on this node when you change its state into &quot;Absent&quot; or &quot;Dead&quot;.
</pre>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id29" id="oarremoveresource" name="oarremoveresource">3.1.3&nbsp;&nbsp;&nbsp;<em>oarremoveresource</em></a></h3>
<p>This command permits to remove a resource from the database.</p>
<p>The node must be in the state &quot;Dead&quot; (use <em>oarnodesetting</em> to do this) and then
you can use this command to delete it.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id30" id="oaraccounting" name="oaraccounting">3.1.4&nbsp;&nbsp;&nbsp;<em>oaraccounting</em></a></h3>
<p>This command permits to update the <em>accounting</em> table for jobs ended since the
last launch.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id31" id="oarnotify" name="oarnotify">3.1.5&nbsp;&nbsp;&nbsp;<em>oarnotify</em></a></h3>
<p>This command sends commands to the &quot;Almighty&quot; module. It is dedicated to
developpers.</p>
<p>You can use the &quot;-v&quot; option to show the OAR version.</p>
</div>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id32" id="database-scheme" name="database-scheme">3.2&nbsp;&nbsp;&nbsp;Database scheme</a></h2>
<div align="center" class="figure">
<a class="reference image-reference" href="db_scheme.png"><img alt="Database scheme" src="db_scheme.png" style="width: 18cm;" /></a>
<p class="caption">Database scheme
(red lines seem PRIMARY KEY,
blue lines seem INDEX)</p>
</div>
<p><a class="reference" href="db_scheme.svg">db_scheme.svg</a></p>
<div class="section">
<h3><a class="toc-backref" href="#id33" id="accounting" name="accounting">3.2.1&nbsp;&nbsp;&nbsp;<em>accounting</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>window_start</td>
<td>DATETIME</td>
<td>start date of the accounting interval</td>
</tr>
<tr><td>window_stop</td>
<td>DATETIME</td>
<td>stop date of the accounting interval</td>
</tr>
<tr><td>accounting_user</td>
<td>VARCHAR(20)</td>
<td>user name</td>
</tr>
<tr><td>queue_name</td>
<td>VARCHAR(100)</td>
<td>queue name</td>
</tr>
<tr><td>consumption_type</td>
<td>ENUM(&quot;ASKED&quot;,&quot;USED&quot;)</td>
<td>&quot;ASKED&quot; corresponds to the walltimes
specified by the user. &quot;USED&quot;
corresponds to the effective time
used by the user.</td>
</tr>
<tr><td>consumption</td>
<td>INT UNSIGNED</td>
<td>number of seconds used</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">window_start, window_stop, accounting_user, queue_name, consumption_type</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">window_start, window_stop, accounting_user, queue_name, consumption_type</td>
</tr>
</tbody>
</table>
<p>This table is a summary of the comsumption for each user on each queue. This
increases the speed of queries about user consumptions and statistic
generation.</p>
<p>Data are inserted through the command <em>oaraccounting</em> (when a job is treated
the field <em>accounted</em> in table jobs is passed into &quot;YES&quot;). So it is possible to
regenerate this table completely in this way :</p>
<blockquote>
<ul>
<li><p class="first">Delete all data of the table:</p>
<pre class="literal-block">
DELETE FROM accounting;
</pre>
</li>
<li><p class="first">Set the field <em>accounted</em> in the table jobs to &quot;NO&quot; for each row:</p>
<pre class="literal-block">
UPDATE jobs SET accounted = &quot;NO&quot;;
</pre>
</li>
<li><p class="first">Run the <em>oaraccounting</em> command.</p>
</li>
</ul>
</blockquote>
<p>You can change the amount of time for each window : edit the oar configuration
file and change the value of the tag <em>ACCOUNTING_WINDOW</em>.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id34" id="admission-rules" name="admission-rules">3.2.2&nbsp;&nbsp;&nbsp;<em>admission_rules</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>id</td>
<td>INT UNSIGNED</td>
<td>id number</td>
</tr>
<tr><td>rule</td>
<td>VARCHAR(255)</td>
<td>rule written in Perl applied when a
job is going to be registered</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body"><em>None</em></td>
</tr>
</tbody>
</table>
<p>You can use these rules to change some values of some properties when a job is
submitted. Some examples are better than a long description :</p>
<blockquote>
<ul>
<li><p class="first">Specify the default value for queue parameter</p>
<pre class="literal-block">
INSERT INTO admission_rules (rule) VALUES('
  if (not defined($queue_name)) {
      $queue_name=&quot;default&quot;;
  }
');
</pre>
</li>
<li><p class="first">Avoid users except oar to go in the admin queue</p>
<pre class="literal-block">
INSERT INTO admission_rules (rule) VALUES ('
  if (($queue_name eq &quot;admin&quot;) &amp;&amp; ($user ne &quot;oar&quot;)) {
    die(&quot;[ADMISSION RULE] Only oar user can submit jobs in the admin queue\\n&quot;);
  }
');
</pre>
</li>
<li><p class="first">Restrict the maximum of the walltime for intercative jobs</p>
<pre class="literal-block">
INSERT INTO admission_rules (rule) VALUES ('
  my $max_walltime = &quot;12:00:00&quot;;
  if ($jobType eq &quot;INTERACTIVE&quot;){
    foreach my $mold (&#64;{$ref_resource_list}){
      if ((defined($mold-&gt;[1])) and (sql_to_duration($max_walltime) &lt; sql_to_duration($mold-&gt;[1]))){
        print(&quot;[ADMISSION RULE] Walltime to big for an INTERACTIVE job so it is set to $max_walltime.\\n&quot;);
        $mold-&gt;[1] = $max_walltime;
      }
    }
  }
');
</pre>
</li>
<li><p class="first">Specify the default walltime</p>
<pre class="literal-block">
INSERT INTO admission_rules (rule) VALUES ('
  my $default_wall = &quot;2:00:00&quot;;
  foreach my $mold (&#64;{$ref_resource_list}){
    if (!defined($mold-&gt;[1])){
      print(&quot;[ADMISSION RULE] Set default walltime to $default_wall.\\n&quot;);
      $mold-&gt;[1] = $default_wall;
    }
  }
');
</pre>
</li>
<li><p class="first">How to perform actions if the user name is in a file</p>
<pre class="literal-block">
INSERT IGNORE INTO admission_rules (rule) VALUES ('
  open(FILE, &quot;/tmp/users.txt&quot;);
  while (($queue_name ne &quot;admin&quot;) and ($_ = &lt;FILE&gt;)){
    if ($_ =~ m/^\\s*$user\\s*$/m){
      print(&quot;[ADMISSION RULE] Change assigned queue into admin\\n&quot;);
      $queue_name = &quot;admin&quot;;
    }
  }
  close(FILE);
');
</pre>
</li>
</ul>
</blockquote>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id35" id="event-logs" name="event-logs">3.2.3&nbsp;&nbsp;&nbsp;<em>event_logs</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>event_id</td>
<td>INT UNSIGNED</td>
<td>event identifier</td>
</tr>
<tr><td>type</td>
<td>VARCHAR(50)</td>
<td>event type</td>
</tr>
<tr><td>job_id</td>
<td>INT UNSIGNED</td>
<td>job related of the event</td>
</tr>
<tr><td>date</td>
<td>DATETIME</td>
<td>event date</td>
</tr>
<tr><td>description</td>
<td>VARCHAR(255)</td>
<td>textual description of the event</td>
</tr>
<tr><td>to_check</td>
<td>ENUM('YES','NO')</td>
<td>specify if the module <em>NodeChangeState</em>
must check this event to Suspect or not
some nodes</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">event_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">type, to_check</td>
</tr>
</tbody>
</table>
<p>The different event types are:</p>
<blockquote>
<ul>
<li><p class="first">&quot;PING_CHECKER_NODE_SUSPECTED&quot; : the system detected via the module &quot;finaud&quot;
that a node is not responding.</p>
</li>
<li><p class="first">&quot;PROLOGUE_ERROR&quot; : an error occured during the execution of the job
prologue (exit code != 0).</p>
</li>
<li><p class="first">&quot;EPILOGUE_ERROR&quot; : an error occured during the execution of the job
epilogue (exit code != 0).</p>
</li>
<li><dl class="first docutils">
<dt>&quot;CANNOT_CREATE_TMP_DIRECTORY&quot; <span class="classifier-delimiter">:</span> <span class="classifier">OAR cannot create the directory where all</span></dt>
<dd><p class="first last">information files will be stored.</p>
</dd>
</dl>
</li>
<li><p class="first">&quot;CAN_NOT_WRITE_NODE_FILE&quot; : the system was not able to write file which had
to contain the node list on the first node (<em>/tmp/OAR_job_id</em>).</p>
</li>
<li><p class="first">&quot;CAN_NOT_WRITE_PID_FILE&quot; : the system was not able to write the file which had
to contain the pid of oarexec process on the first node
(<em>/tmp/pid_of_oarexec_for_job_id</em>).</p>
</li>
<li><p class="first">&quot;USER_SHELL&quot; : the system was not able to get informations about the user
shell on the first node.</p>
</li>
<li><p class="first">&quot;EXIT_VALUE_OAREXEC&quot; : the oarexec process terminated with an unknown exit
code.</p>
</li>
<li><p class="first">&quot;SEND_KILL_JOB&quot; : signal that OAR has transmitted a kill signal to the
oarexec of the specified job.</p>
</li>
<li><p class="first">&quot;LEON_KILL_BIPBIP_TIMEOUT&quot; : Leon module has detected that somehing wrong
occured during the kill of a job and so kill the local <em>bipbip</em> process.</p>
</li>
<li><p class="first">&quot;EXTERMINATE_JOB&quot; : Leon module has detected that something wrong occured
during the kill of a job and so clean the database and terminate the job
artificially.</p>
</li>
<li><p class="first">&quot;WORKING_DIRECTORY&quot; : the directory from which the job was submitted does
not exist on the node assigned by the system.</p>
</li>
<li><p class="first">&quot;OUTPUT_FILES&quot; : OAR cannot write the output files (stdout and stderr) in
the working directory.</p>
</li>
<li><p class="first">&quot;CANNOT_NOTIFY_OARSUB&quot; : OAR cannot notify the <a class="reference" href="#oarsub">oarsub</a> process for an
interactive job (maybe the user has killed this process).</p>
</li>
<li><p class="first">&quot;WALLTIME&quot; : the job has reached its walltime.</p>
</li>
<li><p class="first">&quot;SCHEDULER_REDUCE_NB_NODES_FOR_RESERVATION&quot; : this means that there is not
enough nodes for the reservation and so the scheduler do the best and
gives less nodes than the user wanted (this occures when nodes become
Suspected or Absent).</p>
</li>
<li><p class="first">&quot;BESTEFFORT_KILL&quot; : the job is of the type <em>besteffort</em> and was killed
because a normal job wanted the nodes.</p>
</li>
<li><p class="first">&quot;FRAG_JOB_REQUEST&quot; : someone wants to delete a job.</p>
</li>
<li><p class="first">&quot;CHECKPOINT&quot; : the checkpoint signal was send to the job.</p>
</li>
<li><p class="first">&quot;CHECKPOINT_ERROR&quot; : OAR cannot send the signal to the job.</p>
</li>
<li><p class="first">&quot;CHECKPOINT_SUCCESS&quot; : system has sent the signal correctly.</p>
</li>
<li><p class="first">&quot;SERVER_EPILOGUE_TIMEOUT&quot; : epilogue server script has timeouted.</p>
</li>
<li><p class="first">&quot;SERVER_EPILOGUE_EXIT_CODE_ERROR&quot; : epilogue server script did not return 0.</p>
</li>
<li><p class="first">&quot;SERVER_EPILOGUE_ERROR&quot; : cannot find epilogue server script file.</p>
</li>
<li><p class="first">&quot;SERVER_PROLOGUE_TIMEOUT&quot; : prologue server script has timeouted.</p>
</li>
<li><p class="first">&quot;SERVER_PROLOGUE_EXIT_CODE_ERROR&quot; : prologue server script did not return 0.</p>
</li>
<li><p class="first">&quot;SERVER_PROLOGUE_ERROR&quot; : cannot find prologue server script file.</p>
</li>
<li><p class="first">&quot;CPUSET_CLEAN_ERROR&quot; : OAR cannot clean correctly cpuset files for a job on the remote node.</p>
</li>
<li><p class="first">&quot;MAIL_NOTIFICATION_ERROR&quot; : a mail cannot be sent.</p>
</li>
<li><p class="first">&quot;USER_MAIL_NOTIFICATION&quot; : user mail notification cannot be performed.</p>
</li>
<li><p class="first">&quot;USER_EXEC_NOTIFICATION_ERROR&quot; : user script execution notification cannot be performed.</p>
</li>
<li><p class="first">&quot;BIPBIP_BAD_JOBID&quot; : error when retriving informations about a running job.</p>
</li>
<li><p class="first">&quot;BIPBIP_CHALLENGE&quot; : OAR is configured to detach jobs when they are launched
on compute nodes and the job return a bad challenge number.</p>
</li>
<li><p class="first">&quot;RESUBMIT_JOB_AUTOMATICALLY&quot; : the job was automatically resubmitted.</p>
</li>
<li><p class="first">&quot;WALLTIME&quot; : the job reached its walltime.</p>
</li>
<li><p class="first">&quot;REDUCE_RESERVATION_WALLTIME&quot; : the reservation job was shrinked.</p>
</li>
<li><p class="first">&quot;SSH_TRANSFER_TIMEOUT&quot; : node OAR part script was too long to transfer.</p>
</li>
<li><p class="first">&quot;BAD_HASHTABLE_DUMP&quot; : OAR transfered a bad hashtable.</p>
</li>
<li><p class="first">&quot;LAUNCHING_OAREXEC_TIMEOUT&quot; : oarexec was too long to initialize itself.</p>
</li>
</ul>
</blockquote>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id36" id="event-log-hostnames" name="event-log-hostnames">3.2.4&nbsp;&nbsp;&nbsp;<em>event_log_hostnames</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>event_id</td>
<td>INT UNSIGNED</td>
<td>event identifier</td>
</tr>
<tr><td>hostname</td>
<td>VARCHAR(255)</td>
<td>name of the node where the event
has occured</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">event_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">hostname</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id37" id="files" name="files">3.2.5&nbsp;&nbsp;&nbsp;<em>files</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>idFile</td>
<td>INT UNSIGNED</td>
<td>&nbsp;</td>
</tr>
<tr><td>md5sum</td>
<td>VARCHAR(255)</td>
<td>&nbsp;</td>
</tr>
<tr><td>location</td>
<td>VARCHAR(255)</td>
<td>&nbsp;</td>
</tr>
<tr><td>method</td>
<td>VARCHAR(255)</td>
<td>&nbsp;</td>
</tr>
<tr><td>compression</td>
<td>VARCHAR(255)</td>
<td>&nbsp;</td>
</tr>
<tr><td>size</td>
<td>INT UNSIGNED</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">idFile</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">md5sum</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id38" id="frag-jobs" name="frag-jobs">3.2.6&nbsp;&nbsp;&nbsp;<em>frag_jobs</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="35%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>frag_id_job</td>
<td>INT UNSIGNED</td>
<td>job id</td>
</tr>
<tr><td>frag_date</td>
<td>DATETIME</td>
<td>kill job decision date</td>
</tr>
<tr><td>frag_state</td>
<td>ENUM('LEON','TIMER_ARMED',
'LEON_EXTERMINATE',
'FRAGGED')
DEFAULT 'LEON'</td>
<td>state to tell Leon what to do</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">frag_id_job</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">frag_state</td>
</tr>
</tbody>
</table>
<p>What mean the states:</p>
<blockquote>
<ul class="simple">
<li>&quot;LEON&quot; : the Leon module must try to kill the job and change the state into
&quot;TIMER_ARMED&quot;.</li>
<li>&quot;TIMER_ARMED&quot; : the Sarko module must wait a response from the job during
a timeout (default is 60s)</li>
<li>&quot;LEON_EXTERMINATE&quot; : the Sarko module has decided that the job timeouted and
asked Leon to clean up the database.</li>
<li>&quot;FRAGGED&quot; : job is fragged.</li>
</ul>
</blockquote>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id39" id="gantt-jobs-resources" name="gantt-jobs-resources">3.2.7&nbsp;&nbsp;&nbsp;<em>gantt_jobs_resources</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>moldable_job_id</td>
<td>INT UNSIGNED</td>
<td>moldable job id</td>
</tr>
<tr><td>resource_id</td>
<td>INT UNSIGNED</td>
<td>resource assigned to the job</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">moldable_job_id, resource_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body"><em>None</em></td>
</tr>
</tbody>
</table>
<p>This table specifies which resources are attributed to which jobs.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id40" id="gantt-jobs-resources-visu" name="gantt-jobs-resources-visu">3.2.8&nbsp;&nbsp;&nbsp;<em>gantt_jobs_resources_visu</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>moldable_job_id</td>
<td>INT UNSIGNED</td>
<td>moldable job id</td>
</tr>
<tr><td>resource_id</td>
<td>INT UNSIGNED</td>
<td>resource assigned to the job</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">moldable_job_id, resource_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body"><em>None</em></td>
</tr>
</tbody>
</table>
<p>This table is the same as <em>gantt_jobs_resources</em> and is used by visualisation tools.
It is made up to date in an atomic action (with a lock).</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id41" id="gantt-jobs-predictions" name="gantt-jobs-predictions">3.2.9&nbsp;&nbsp;&nbsp;<em>gantt_jobs_predictions</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>moldable_job_id</td>
<td>INT UNSIGNED</td>
<td>job id</td>
</tr>
<tr><td>start_time</td>
<td>DATETIME</td>
<td>date when the job is scheduled to start</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">moldable_job_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body"><em>None</em></td>
</tr>
</tbody>
</table>
<p>With this table and <em>gantt_jobs_resources</em> you can know exactly what are the decisions
taken by the schedulers for each waiting jobs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">note:</th><td class="field-body">The special job id &quot;0&quot; is used to store the scheduling reference date.</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id42" id="gantt-jobs-predictions-visu" name="gantt-jobs-predictions-visu">3.2.10&nbsp;&nbsp;&nbsp;<em>gantt_jobs_predictions_visu</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>moldable_job_id</td>
<td>INT UNSIGNED</td>
<td>job id</td>
</tr>
<tr><td>start_time</td>
<td>DATETIME</td>
<td>date when the job is scheduled to start</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">job_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body"><em>None</em></td>
</tr>
</tbody>
</table>
<p>This table is the same as <em>gantt_jobs_predictions</em> and is used by visualisation
tools. It is made up to date in an atomic action (with a lock).</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id43" id="jobs" name="jobs">3.2.11&nbsp;&nbsp;&nbsp;<em>jobs</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="27%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>job_id</td>
<td>INT UNSIGNED</td>
<td>job identifier</td>
</tr>
<tr><td>job_name</td>
<td>VARCHAR(100)</td>
<td>name given by the user</td>
</tr>
<tr><td>cpuset_name</td>
<td>VARCHAR(255)</td>
<td>name of the cpuset directory used for
this job on each nodes</td>
</tr>
<tr><td>job_type</td>
<td>ENUM('INTERACTIVE',
'PASSIVE') DEFAULT
'PASSIVE'</td>
<td>specify if the user wants to launch a
program or get an interactive shell</td>
</tr>
<tr><td>info_type</td>
<td>VARCHAR(255)</td>
<td>some informations about <a class="reference" href="#oarsub">oarsub</a>
command</td>
</tr>
<tr><td>state</td>
<td>ENUM('Waiting','Hold',
'toLaunch','toError',
'toAckReservation',
'Launching','Running',
'Finishing',
'Terminated','Error')</td>
<td>job state</td>
</tr>
<tr><td>reservation</td>
<td>ENUM('None',
'toSchedule',
'Scheduled') DEFAULT
'None'</td>
<td>specify if the job is a reservation
and the state of this one</td>
</tr>
<tr><td>message</td>
<td>VARCHAR(255)</td>
<td>readable information message for the
user</td>
</tr>
<tr><td>job_user</td>
<td>VARCHAR(20)</td>
<td>user name</td>
</tr>
<tr><td>command</td>
<td>TEXT</td>
<td>program to run</td>
</tr>
<tr><td>queue_name</td>
<td>VARCHAR(100)</td>
<td>queue name</td>
</tr>
<tr><td>properties</td>
<td>TEXT</td>
<td>properties that assigned nodes must
match</td>
</tr>
<tr><td>launching_directory</td>
<td>VARCHAR(255)</td>
<td>path of the directory where to launch
the user process</td>
</tr>
<tr><td>submission_time</td>
<td>DATETIME</td>
<td>date when the job was submitted</td>
</tr>
<tr><td>start_time</td>
<td>DATETIME</td>
<td>date when the job was launched</td>
</tr>
<tr><td>stop_time</td>
<td>DATETIME</td>
<td>date when the job was stopped</td>
</tr>
<tr><td>file_id</td>
<td>INT UNSIGNED</td>
<td>&nbsp;</td>
</tr>
<tr><td>accounted</td>
<td>ENUM(&quot;YES&quot;,&quot;NO&quot;)
DEFAULT &quot;NO&quot;</td>
<td>specify if the job was considered by
the accounting mechanism or not</td>
</tr>
<tr><td>notify</td>
<td>VARCHAR(255)</td>
<td>gives the way to notify the user about
the job (mail or script )</td>
</tr>
<tr><td>assigned_moldable_job</td>
<td>INT UNSIGNED</td>
<td>moldable job chosen by the scheduler</td>
</tr>
<tr><td>checkpoint</td>
<td>INT UNSIGNED</td>
<td>number of seconds before the walltime
to send the checkpoint signal to the
job</td>
</tr>
<tr><td>checkpoint_signal</td>
<td>INT UNSIGNED</td>
<td>signal to use when checkpointing the
job</td>
</tr>
<tr><td>stdout_file</td>
<td>TEXT</td>
<td>file name where to redirect program
STDOUT</td>
</tr>
<tr><td>stderr_file</td>
<td>TEXT</td>
<td>file name where to redirect program
STDERR</td>
</tr>
<tr><td>resubmit_job_id</td>
<td>INT UNSIGNED</td>
<td>if a job is resubmitted then the new
one store the previous</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">job_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">state, reservation, queue_name, accounted</td>
</tr>
</tbody>
</table>
<p>Explications about the &quot;state&quot; field:</p>
<blockquote>
<ul class="simple">
<li>&quot;Waiting&quot; : the job is waiting OAR sheduler decision.</li>
<li>&quot;Hold&quot; : user or administrator wants to hold the job (<a class="reference" href="#oarhold">oarhold</a> command).
So it will not be scheduled by the system.</li>
<li>&quot;toLaunch&quot; : the OAR scheduler has attributed some nodes to the job. So it
will be launched.</li>
<li>&quot;toError&quot; : something wrong occured and the job is going into the error
state.</li>
<li>&quot;toAckReservation&quot; : the OAR sheduler must say &quot;YES&quot; or &quot;NO&quot; to the waiting
<a class="reference" href="#oarsub">oarsub</a> command because it requested a reservation.</li>
<li>&quot;Launching&quot; : OAR has launched the job and will execute the user command
on the first node.</li>
<li>&quot;Running&quot; : the user command is executing on the first node.</li>
<li>&quot;Finishing&quot; : the user command is terminated and OAR is doing work internally</li>
<li>&quot;Terminated&quot; : the job is terminated normally.</li>
<li>&quot;Error&quot; : a problem has occured.</li>
</ul>
</blockquote>
<p>Explications about the &quot;reservation&quot; field:</p>
<blockquote>
<ul class="simple">
<li>&quot;None&quot; : the job is not a reservation.</li>
<li>&quot;toSchedule&quot; : the job is a reservation and must be approved by the
scheduler.</li>
<li>&quot;Scheduled&quot; : the job is a reservation and is scheduled by OAR.</li>
</ul>
</blockquote>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id44" id="job-dependencies" name="job-dependencies">3.2.12&nbsp;&nbsp;&nbsp;<em>job_dependencies</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>job_id</td>
<td>INT UNSIGNED</td>
<td>job identifier</td>
</tr>
<tr><td>job_id_required</td>
<td>INT UNSIGNED</td>
<td>job needed to be completed before
launching job_id</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">job_id, job_id_required</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">job_id, job_id_required</td>
</tr>
</tbody>
</table>
<p>This table is feeded by <a class="reference" href="#oarsub">oarsub</a> command with the &quot;-a&quot; option.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id45" id="moldable-job-descriptions" name="moldable-job-descriptions">3.2.13&nbsp;&nbsp;&nbsp;<em>moldable_job_descriptions</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>moldable_id</td>
<td>INT UNSIGNED</td>
<td>job identifier</td>
</tr>
<tr><td>moldable_job_id</td>
<td>INT UNSIGNED</td>
<td>corresponding job identifier</td>
</tr>
<tr><td>moldable_wallime</td>
<td>VARCHAR(255)</td>
<td>instance duration</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">moldable_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">moldable_job_id</td>
</tr>
</tbody>
</table>
<p>A job can be described with several instances. Thus OAR scheduler can choose one
of them. For example it can calculate which instance will finish the first.
So this table stores all instances for all jobs.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id46" id="job-resource-groups" name="job-resource-groups">3.2.14&nbsp;&nbsp;&nbsp;<em>job_resource_groups</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="25%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>res_group_id</td>
<td>INT UNSIGNED</td>
<td>group identifier</td>
</tr>
<tr><td>res_group_moldable_id</td>
<td>INT UNSIGNED</td>
<td>corresponding moldable job identifier</td>
</tr>
<tr><td>res_group_property</td>
<td>TEXT</td>
<td>SQL constraint properties</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">res_group_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">res_group_moldable_id</td>
</tr>
</tbody>
</table>
<p>As you can specify job global properties with <a class="reference" href="#oarsub">oarsub</a> and the &quot;-p&quot; option, you
can do the same thing for each resource groups that you define with the &quot;-l&quot; option.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id47" id="job-resource-descriptions" name="job-resource-descriptions">3.2.15&nbsp;&nbsp;&nbsp;<em>job_resource_descriptions</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="25%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>res_job_group_id</td>
<td>INT UNSIGNED</td>
<td>corresponding group identifier</td>
</tr>
<tr><td>res_job_resource_type</td>
<td>VARCHAR(255)</td>
<td>resource type (name of a field in
resources)</td>
</tr>
<tr><td>res_job_value</td>
<td>INT</td>
<td>wanted resource number</td>
</tr>
<tr><td>res_job_order</td>
<td>INT UNSIGNED</td>
<td>order of the request</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">res_job_group_id, res_job_resource_type, res_job_order</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">res_job_group_id</td>
</tr>
</tbody>
</table>
<p>This table store the hierarchical resource description given with <a class="reference" href="#oarsub">oarsub</a> and
the &quot;-l&quot; option.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id48" id="job-state-logs" name="job-state-logs">3.2.16&nbsp;&nbsp;&nbsp;<em>job_state_logs</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>job_id</td>
<td>INT UNSIGNED</td>
<td>corresponding job identifier</td>
</tr>
<tr><td>job_state</td>
<td>ENUM('Alive','Dead'
,'Suspected',
'Absent')</td>
<td>job state during the interval</td>
</tr>
<tr><td>date_start</td>
<td>DATETIME</td>
<td>start date of the interval</td>
</tr>
<tr><td>date_stop</td>
<td>DATETIME</td>
<td>end date of the interval</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body"><em>None</em></td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">job_id, job_state</td>
</tr>
</tbody>
</table>
<p>This table keeps informations about state changes of jobs.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id49" id="job-types" name="job-types">3.2.17&nbsp;&nbsp;&nbsp;<em>job_types</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>job_id</td>
<td>INT UNSIGNED</td>
<td>corresponding job identifier</td>
</tr>
<tr><td>type</td>
<td>VARCHAR(255)</td>
<td>job type like &quot;deploy&quot;, &quot;timesharing&quot;,
...</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body"><em>None</em></td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">job_id, type</td>
</tr>
</tbody>
</table>
<p>This table stores job types given with the <a class="reference" href="#oarsub">oarsub</a> command and &quot;-t&quot; options.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id50" id="resources" name="resources">3.2.18&nbsp;&nbsp;&nbsp;<em>resources</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>resource_id</td>
<td>INT UNSIGNED</td>
<td>resource identifier</td>
</tr>
<tr><td>network_address</td>
<td>VARCHAR(100)</td>
<td>node name (used to connect via SSH)</td>
</tr>
<tr><td>state</td>
<td>ENUM('Alive','Dead',
'Suspected',
'Absent')</td>
<td>resource state</td>
</tr>
<tr><td>next_state</td>
<td>ENUM('UnChanged',
'Alive','Dead',
'Absent','Suspected'
) DEFAULT
'UnChanged'</td>
<td>state for the resource to switch</td>
</tr>
<tr><td>finaud_decision</td>
<td>ENUM('YES','NO')
DEFAULT 'NO'</td>
<td>tell if the actual state results in a
&quot;finaud&quot; module decision</td>
</tr>
<tr><td>next_finaud_decision</td>
<td>ENUM('YES','NO')
DEFAULT 'NO'</td>
<td>tell if the next node state results in
a &quot;finaud&quot; module decision</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">resource_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">state, next_state</td>
</tr>
</tbody>
</table>
<p>State explications:</p>
<blockquote>
<ul class="simple">
<li>&quot;Alive&quot; : the resource is ready to accept a job.</li>
<li>&quot;Absent&quot; : the oar administrator has decided to pull out the resource. This
computer can come back.</li>
<li>&quot;Suspected&quot; : OAR system has detected a problem on this resource and so has
suspected it (you can look in the <a class="reference" href="#event-logs">event_logs</a> table to know what has
happened). This computer can come back (automatically if this is a
&quot;finaud&quot; module decision).</li>
<li>&quot;Dead&quot; : The oar administrator considers that the resource will not come back
and will be removed from the pool.</li>
</ul>
</blockquote>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id51" id="resource-state-logs" name="resource-state-logs">3.2.19&nbsp;&nbsp;&nbsp;<em>resource_state_logs</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>resource_id</td>
<td>INT UNSIGNED</td>
<td>resource identifier</td>
</tr>
<tr><td>change_state</td>
<td>ENUM('Alive','Dead'
,'Suspected',
'Absent')</td>
<td>resource state during the interval</td>
</tr>
<tr><td>date_start</td>
<td>DATETIME</td>
<td>start date of the interval</td>
</tr>
<tr><td>date_stop</td>
<td>DATETIME</td>
<td>end date of the interval</td>
</tr>
<tr><td>finaud_decision</td>
<td>ENUM('YES','NO')
DEFAULT 'NO'</td>
<td>specify if that was a &quot;finaud&quot; module
decision</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body"><em>None</em></td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">resource_id, change_state, finaud_decision</td>
</tr>
</tbody>
</table>
<p>This table keeps informations about state changes of resources.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id52" id="resource-properties" name="resource-properties">3.2.20&nbsp;&nbsp;&nbsp;<em>resource_properties</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="26%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>resource_id</td>
<td>INT UNSIGNED</td>
<td>resource identifier</td>
</tr>
<tr><td>node</td>
<td>VARCHAR(200)</td>
<td>node name</td>
</tr>
<tr><td>besteffort</td>
<td>ENUM('YES','NO')
DEFAULT 'YES'</td>
<td>specify if the resource accepts or not
besteffort jobs</td>
</tr>
<tr><td>deploy</td>
<td>ENUM('YES','NO')
DEFAULT 'NO'</td>
<td>specify if the resource accepts or not
deployment jobs</td>
</tr>
<tr><td>expiry_date</td>
<td>DATETIME</td>
<td>used in desktop computing mode to know
when a resource is considered to be
offline</td>
</tr>
<tr><td>desktop_computing</td>
<td>ENUM('YES','NO')
DEFAULT 'NO'</td>
<td>specify if the resource is a desktop
computing resource or not</td>
</tr>
<tr><td>cpuset</td>
<td>INT UNSIGNED</td>
<td>cpu number in the node</td>
</tr>
<tr><td>cpu</td>
<td>INT UNSIGNED</td>
<td>cpu number in the cluster</td>
</tr>
<tr><td>switch</td>
<td>VARCHAR(50)</td>
<td>switch name</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">resource_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body"><em>None</em></td>
</tr>
</tbody>
</table>
<p>This table permits to specify different properties for each resources. These can
be used with the <a class="reference" href="#oarsub">oarsub</a> command (&quot;-p&quot; and &quot;-l&quot; options).</p>
<p>You can add your own properties with <a class="reference" href="#oarproperty">oarproperty</a> command.</p>
<p>These properties can be updated with the <a class="reference" href="#oarnodesetting">oarnodesetting</a> command (&quot;-p&quot; option).</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id53" id="resource-property-logs" name="resource-property-logs">3.2.21&nbsp;&nbsp;&nbsp;<em>resource_property_logs</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="26%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>resource_id</td>
<td>INT UNSIGNED</td>
<td>resource identifier</td>
</tr>
<tr><td>attribute</td>
<td>VARCHAR(255)</td>
<td>name of corresponding field in
resource_properties</td>
</tr>
<tr><td>value</td>
<td>VARCHAR(255)</td>
<td>value of the field</td>
</tr>
<tr><td>date_start</td>
<td>DATETIME</td>
<td>interval start date</td>
</tr>
<tr><td>date_stop</td>
<td>DATETIME</td>
<td>interval stop date</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body"><em>None</em></td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">resource_id, attribute</td>
</tr>
</tbody>
</table>
<p>This table permits to keep a trace of every property changes (consequence of
the <a class="reference" href="#oarnodesetting">oarnodesetting</a> command with the &quot;-p&quot; option).</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id54" id="assigned-resources" name="assigned-resources">3.2.22&nbsp;&nbsp;&nbsp;<em>assigned_resources</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>moldable_job_id</td>
<td>INT UNSIGNED</td>
<td>job id</td>
</tr>
<tr><td>resource_id</td>
<td>INT UNSIGNED</td>
<td>resource assigned to the job</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">moldable_job_id, resource_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body">moldable_job_id</td>
</tr>
</tbody>
</table>
<p>This table keeps information for jobs on which resources they were
scheduled.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id55" id="queues" name="queues">3.2.23&nbsp;&nbsp;&nbsp;<em>queues</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>queue_name</td>
<td>VARCHAR(100)</td>
<td>queue name</td>
</tr>
<tr><td>priority</td>
<td>INT UNSIGNED</td>
<td>the scheduling priority</td>
</tr>
<tr><td>scheduler_policy</td>
<td>VARCHAR(100)</td>
<td>path of the associated scheduler</td>
</tr>
<tr><td>state</td>
<td>ENUM('Active',
'notActive')
DEFAULT 'Active'</td>
<td>permits to stop the scheduling for a
queue</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">queue_name</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body"><em>None</em></td>
</tr>
</tbody>
</table>
<p>This table contains the schedulers executed by the <em>oar_meta_scheduler</em> module.
Executables are launched one after one in the specified priority.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id56" id="challenges" name="challenges">3.2.24&nbsp;&nbsp;&nbsp;<em>challenges</em></a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Fields</th>
<th class="head">Types</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>job_id</td>
<td>INT UNSIGNED</td>
<td>job identifier</td>
</tr>
<tr><td>challenge</td>
<td>VARCHAR(255)</td>
<td>challenge string</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Primary key:</th><td class="field-body">job_id</td>
</tr>
<tr class="field"><th class="field-name">Index fields:</th><td class="field-body"><em>None</em></td>
</tr>
</tbody>
</table>
<p>This table is used to share a secret between OAR server and oarexec process on
computing nodes (avoid a job id to be stole by malicious man).</p>
</div>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id57" id="configuration-file" name="configuration-file">4&nbsp;&nbsp;&nbsp;Configuration file</a></h1>
<p>This is the meanings for each configuration tags that you can find in /etc/oar.conf:</p>
<blockquote>
<ul>
<li><p class="first">Database type : you can use a MySQL or a PostgreSQL database (tags are &quot;mysql&quot; or &quot;Pg&quot;):</p>
<pre class="literal-block">
DB_TYPE = mysql
</pre>
</li>
<li><p class="first">Database hostname:</p>
<pre class="literal-block">
DB_HOSTNAME=localhost
</pre>
</li>
<li><p class="first">Database base name:</p>
<pre class="literal-block">
DB_BASE_NAME=oar
</pre>
</li>
<li><p class="first">DataBase user name:</p>
<pre class="literal-block">
DB_BASE_LOGIN=oar
</pre>
</li>
<li><p class="first">DataBase user password:</p>
<pre class="literal-block">
DB_BASE_PASSWD=oar
</pre>
</li>
<li><p class="first">OAR server hostname:</p>
<pre class="literal-block">
SERVER_HOSTNAME=localhost
</pre>
</li>
<li><p class="first">OAR server port:</p>
<pre class="literal-block">
SERVER_PORT=6666
</pre>
</li>
<li><p class="first">When the user does not specify a -l option then oar use this:</p>
<pre class="literal-block">
OARSUB_DEFAULT_RESOURCES = /resource_id=1
</pre>
</li>
<li><p class="first">Specify where we are connected in the deploy queue(the node to connect
to when the job is in the deploy queue):</p>
<pre class="literal-block">
DEPLOY_HOSTNAME = 127.0.0.1
</pre>
</li>
<li><p class="first">Set DETACH_JOB_FROM_SERVER to 1 if you do not want to keep a ssh connection between the
node and the server. Otherwise set this tag to 0:</p>
<pre class="literal-block">
DETACH_JOB_FROM_SERVER=1
</pre>
</li>
<li><p class="first">By default OAR uses the ping command to detect if nodes are down or not.
To enhance this diagnostic you can specify one of these other methods (
give the complete command path):</p>
<blockquote>
<ul>
<li><p class="first">OAR sentinelle:</p>
<pre class="literal-block">
SENTINELLE_COMMAND=/usr/bin/sentinelle -cconnect=ssh,timeout=3000
</pre>
</li>
<li><p class="first">OAR fping:</p>
<pre class="literal-block">
FPING_COMMAND=/usr/bin/fping -q
</pre>
</li>
<li><p class="first">OAR nmap : it will test to connect on the ssh port (22):</p>
<pre class="literal-block">
NMAP_COMMAND=/usr/bin/nmap -p 22 -n -T5
</pre>
</li>
<li><p class="first">OAR generic : a specific script may be used instead of ping to check aliveness of nodes.
The script must return bad nodes on STDERR (1 line for a bad node and it must
have exactly the same name that OAR has given in argument of the command):</p>
<pre class="literal-block">
GENERIC_COMMAND=/path/to/command arg1 arg2
</pre>
</li>
</ul>
</blockquote>
</li>
<li><p class="first">OAR log level: 3(debug+warnings+errors), 2(warnings+errors), 1(errors):</p>
<pre class="literal-block">
LOG_LEVEL=2
</pre>
</li>
<li><p class="first">OAR log file:</p>
<pre class="literal-block">
LOG_FILE=/var/log/oar.log
</pre>
</li>
<li><p class="first">If you want to debug oarexec on nodes then affect 1 (only effective if DETACH_JOB_FROM_SERVER = 1):</p>
<pre class="literal-block">
OAREXEC_DEBUG_MODE=0
</pre>
</li>
<li><p class="first">OAR Allowed networks, Networks or hosts allowed to submit jobs to OAR and
compute nodes may be specified here(0.0.0.0/0 means all IPs are allowed
and 127.0.0.1/32 means only IP 127.0.0.1 is allowed):</p>
<pre class="literal-block">
ALLOWED_NETWORKS= 127.0.0.1/32 0.0.0.0/0
</pre>
</li>
<li><p class="first">Set the granularity of the OAR accounting feature (in seconds). Default is
1 day (86400s):</p>
<pre class="literal-block">
ACCOUNTING_WINDOW= 86400
</pre>
</li>
<li><p class="first">OAR informations may be notified by email to the administror.
Set accordingly to your configuration the next lines to activate
the feature:</p>
<pre class="literal-block">
MAIL_SMTP_SERVER = smtp.serveur.com
MAIL_RECIPIENT = user&#64;domain.com
MAIL_SENDER = oar&#64;domain.com
</pre>
</li>
<li><p class="first">Limitation configuration for the oar_sched_gant_g5k scheduler
(0:Sunday, 1:Monday, 2:Tuesday, 3:Wednesday, 4:Thursday, 5:Friday,
6:Saturday):</p>
<pre class="literal-block">
G5K_LIMIT_WEEK_DAYS = 1 2 3 4 5
G5K_LIMIT_DAY_HOURS = 7 22
</pre>
</li>
<li><p class="first">Set the timeout for the prologue and epilogue execution on computing nodes:</p>
<pre class="literal-block">
PROLOGUE_EPILOGUE_TIMEOUT = 60
</pre>
</li>
<li><p class="first">Files to execute before and after each job on the first computing node (default is ~oar/oar_prologue ans ~oar/oar_epilogue):</p>
<pre class="literal-block">
PROLOGUE_EXEC_FILE = /path/to/prog
EPILOGUE_EXEC_FILE = /path/to/prog
</pre>
</li>
<li><p class="first">Set the timeout for the prologue and epilogue execution on the OAR server:</p>
<pre class="literal-block">
SERVER_PROLOGUE_EPILOGUE_TIMEOUT = 60
</pre>
</li>
<li><p class="first">Files to execute before and after each job on the OAR server:</p>
<pre class="literal-block">
SERVER_PROLOGUE_EXEC_FILE = /path/to/prog
SERVER_EPILOGUE_EXEC_FILE = /path/to/prog
</pre>
</li>
<li><p class="first">Set the frequency for checking Alive and Suspected resources:</p>
<pre class="literal-block">
FINAUD_FREQUENCY = 300
</pre>
</li>
<li><p class="first">Set time after which resources become Dead (default is 0 and it means never):</p>
<pre class="literal-block">
DEAD_SWITCH_TIME = 600
</pre>
</li>
<li><p class="first">Maximum of seconds used by a scheduler:</p>
<pre class="literal-block">
SCHEDULER_TIMEOUT = 10
</pre>
</li>
<li><p class="first">Time to add between each jobs (time for administration tasks or time to let computers to reboot):</p>
<pre class="literal-block">
SCHEDULER_JOB_SECURITY_TIME = 1
</pre>
</li>
<li><p class="first">Minimum time in seconds that can be considered like a hole where a job could be scheduled in:</p>
<pre class="literal-block">
SCHEDULER_GANTT_HOLE_MINIMUM_TIME = 300
</pre>
</li>
<li><p class="first">Indicate the name of the database field that contains the cpu number of the node.
If this option is set then users must use <a class="reference" href="#oarsh">OARSH</a> instead of ssh to walk on each nodes that they have reserved via oarsub.</p>
<pre class="literal-block">
CPUSET_RESOURCE_PROPERTY_DB_FIELD = cpuset
</pre>
</li>
<li><p class="first">Command to use to connect to other nodes (default is &quot;ssh&quot; in the PATH)</p>
<pre class="literal-block">
OPENSSH_CMD = /usr/bin/ssh
</pre>
</li>
<li><p class="first">These are configuration tags for OAR in the desktop-computing mode:</p>
<pre class="literal-block">
DESKTOP_COMPUTING_ALLOW_CREATE_NODE=0
DESKTOP_COMPUTING_EXPIRY=10
STAGEOUT_DIR=/var/lib/oar/stageouts/
STAGEIN_DIR=/var/lib/oar/stageins
STAGEIN_CACHE_EXPIRY=144
</pre>
</li>
</ul>
</blockquote>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id58" id="module-descriptions" name="module-descriptions">5&nbsp;&nbsp;&nbsp;Module descriptions</a></h1>
<p>OAR can be decomposed into several modules which perform different tasks.</p>
<div class="section">
<h2><a class="toc-backref" href="#id59" id="almighty" name="almighty">5.1&nbsp;&nbsp;&nbsp;Almighty</a></h2>
<p>This module is the OAR server. It decides what actions must be performed. It
is divided into 2 processes:</p>
<blockquote>
<ul class="simple">
<li>One listen to a TCP/IP socket. It waits informations or commands from OAR
user program or from the other modules.</li>
<li>Another one treates each commands thanks to an automaton and launch right
modules one after one.</li>
</ul>
</blockquote>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id60" id="sarko" name="sarko">5.2&nbsp;&nbsp;&nbsp;Sarko</a></h2>
<p>This module is executed periodically by the Almighty (default is every
30 seconds).</p>
<p>The jobs of Sarko are :</p>
<blockquote>
<ul class="simple">
<li>Look at running job walltimes and ask to frag them if they had expired.</li>
<li>Detect if fragged jobs are really fragged otherwise asks to exterminate
them.</li>
<li>In &quot;Desktop Computing&quot; mode, it detects if a node date has expired and
asks to change its state into &quot;Suspected&quot;.</li>
</ul>
</blockquote>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id61" id="judas" name="judas">5.3&nbsp;&nbsp;&nbsp;Judas</a></h2>
<p>This is the module dedicated to print and log every debugging, warning and
error text.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id62" id="leon" name="leon">5.4&nbsp;&nbsp;&nbsp;Leon</a></h2>
<p>This module is in charge of the frag of jobs. Other OAR modules or commands
can ask to kill a job and this is Leon which perform that.</p>
<p>There are 2 frag types :</p>
<blockquote>
<ul class="simple">
<li><em>normal</em> : Leon tries to connect to on the first node of the job and tell it
to kill itself.</li>
<li><em>exterminate</em> : after a timeout if the <em>normal</em> method did not succeeded
then Leon notifies this case and clean up the database for these jobs.</li>
</ul>
</blockquote>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id63" id="nodechangestate" name="nodechangestate">5.5&nbsp;&nbsp;&nbsp;NodeChangeState</a></h2>
<p>This module is in charge of changing node states and check if there are jobs
on these.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id64" id="scheduler" name="scheduler">5.6&nbsp;&nbsp;&nbsp;Scheduler</a></h2>
<p>This module checks for each reservation job it validity and the moment to
launch it. And it launches all gantt scheduler in the order of the priority
of the database.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id65" id="runner" name="runner">5.7&nbsp;&nbsp;&nbsp;Runner</a></h2>
<p>This module launches OAR effective jobs. These processes are run asynchronously
with all modules.</p>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id66" id="mechanisms" name="mechanisms">6&nbsp;&nbsp;&nbsp;Mechanisms</a></h1>
<div class="section">
<h2><a class="toc-backref" href="#id67" id="how-does-an-interactive-oarsub-work" name="how-does-an-interactive-oarsub-work">6.1&nbsp;&nbsp;&nbsp;How does an interactive <em>oarsub</em> work?</a></h2>
<div align="center" class="figure">
<a class="reference image-reference" href="interactive_oarsub_scheme.png"><img alt="interactive oarsub decomposition" src="interactive_oarsub_scheme.png" style="width: 18cm;" /></a>
<p class="caption">Interactive oarsub decomposition</p>
</div>
<p><a class="reference" href="interactive_oarsub_scheme.svg">interactive_oarsub_scheme.svg</a></p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id68" id="cpuset" name="cpuset">6.2&nbsp;&nbsp;&nbsp;CPUSET</a></h2>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id69" id="job-launch" name="job-launch">6.3&nbsp;&nbsp;&nbsp;Job launch</a></h2>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id70" id="job-deletion" name="job-deletion">6.4&nbsp;&nbsp;&nbsp;Job deletion</a></h2>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id71" id="checkpoint" name="checkpoint">6.5&nbsp;&nbsp;&nbsp;Checkpoint</a></h2>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id72" id="scheduling" name="scheduling">6.6&nbsp;&nbsp;&nbsp;Scheduling</a></h2>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id73" id="user-notification" name="user-notification">6.7&nbsp;&nbsp;&nbsp;User notification</a></h2>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id74" id="id1" name="id1">6.8&nbsp;&nbsp;&nbsp;Accounting</a></h2>
</div>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference" href="OAR-DOCUMENTATION.rst">View document source</a>.
Generated on: 2006-06-29 10:26 UTC.
Generated by <a class="reference" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.

</div>
</body>
</html>
