#!/usr/bin/perl
# $Id: oarnotify,v 1.9 2004/08/24 15:56:56 neyron Exp $
# notify Almighty

use strict;
use warnings;
use Data::Dumper;
use IO::Socket::INET;
use oar_conflib qw(init_conf dump_conf get_conf is_conf);
use Getopt::Std;
use oarversion;

init_conf("oar.conf");
my $remote_host = get_conf("SERVER_HOSTNAME");
my $remote_port = get_conf("SERVER_PORT");

my %opts;
Getopt::Std::getopts('v', \%opts);
if (defined($opts{v})){
    print("OAR version : ".oarversion::get_version()."\n");
    exit(0);
}


my $tag = "Term";
if (defined($ARGV[0])){
    $tag = $ARGV[0];
}
print("tag = $tag\n");


#Signal Almigthy
my $socket = IO::Socket::INET->new(PeerAddr => $remote_host,
                                   PeerPort => $remote_port,
                                   Proto => "tcp",
                                   Type  => SOCK_STREAM)
             or die "Couldn't connect executor $remote_host:$remote_port\n";
print $socket "$tag\n";
close($socket);

exit 0;
